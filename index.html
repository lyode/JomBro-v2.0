<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JomBro">
    <meta name="theme-color" content="#ff6b9d">
    <meta name="description" content="AI-Powered Social Challenge Platform - Connect, Challenge, Conquer!">
       
    <title>JomBro - Enhanced Full-Featured Challenge Platform</title>

    <style>
        /* ===== ENHANCED LAYERED GLASS SYSTEM ===== */
        
        :root {
            --safe-area-top: env(safe-area-inset-top, 20px);
            --safe-area-bottom: env(safe-area-inset-bottom, 20px);
            --primary-pink: #ff6b9d;
            --primary-purple: #8b5cf6;
            --primary-blue: #00d4ff;
            --accent-pink: #ff8cc8;
            --accent-purple: #a855f7;
            --accent-blue: #3b82f6;
            --dark-bg: #0a0a0a;
            --glass-bg: rgba(15, 15, 15, 0.45);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-shadow: rgba(0, 0, 0, 0.8);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --error-red: #ef4444;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            
            /* Glass Layer System */
            --glass-distance: 3mm;
            --glass-blur: 25px;
            --glass-opacity: 0.15;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            touch-action: manipulation;
        }

        html, body {
            height: 100vh;
            width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: #000000;
            color: var(--text-primary);
            user-select: none;
            overflow: hidden;
            perspective: 2000px;
            perspective-origin: center center;
        }

        /* ===== BOTTOM LAYER: NIGHT SKY BACKGROUND (3mm Behind) ===== */
        
        .background-layer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1;
            overflow: hidden;
            transform: translateZ(-3mm);
            transform-style: preserve-3d;
        }

        .background-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .background-content.active {
            opacity: 1;
        }

        /* Enhanced Clear Dark Night Sky with Ultra-Dense Blinking Stars */
        .space-background {
            background: 
                linear-gradient(180deg, 
                    #000011 0%, 
                    #001122 15%, 
                    #002244 25%, 
                    #001a3a 35%,
                    #002850 45%, 
                    #001133 55%, 
                    #001428 65%,
                    #000822 75%, 
                    #000511 85%,
                    #000208 100%
                );
            position: relative;
            overflow: hidden;
        }

        /* Multi-layered Star System */
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                /* Supernova Stars - Ultra Bright */
                radial-gradient(6px 6px at 120px 50px, #ffffff, transparent),
                radial-gradient(5px 5px at 300px 80px, rgba(255,255,255,0.98), transparent),
                radial-gradient(6px 6px at 180px 150px, #ffffff, transparent),
                radial-gradient(5px 5px at 350px 120px, rgba(255,255,255,0.95), transparent),
                
                /* Bright Major Stars - Large and Prominent */
                radial-gradient(4px 4px at 25px 30px, #ffffff, transparent),
                radial-gradient(3px 3px at 85px 20px, rgba(255,255,255,0.95), transparent),
                radial-gradient(4px 4px at 145px 40px, #ffffff, transparent),
                radial-gradient(3px 3px at 205px 65px, rgba(255,255,255,0.9), transparent),
                radial-gradient(4px 4px at 265px 25px, #ffffff, transparent),
                radial-gradient(3px 3px at 325px 55px, rgba(255,255,255,0.95), transparent),
                radial-gradient(4px 4px at 385px 35px, #ffffff, transparent),
                radial-gradient(3px 3px at 425px 75px, rgba(255,255,255,0.92), transparent),
                radial-gradient(4px 4px at 465px 45px, #ffffff, transparent),
                
                /* Medium Bright Stars */
                radial-gradient(2.5px 2.5px at 55px 50px, rgba(255,255,255,0.85), transparent),
                radial-gradient(2px 2px at 115px 75px, rgba(255,255,255,0.8), transparent),
                radial-gradient(2.5px 2.5px at 175px 15px, rgba(255,255,255,0.9), transparent),
                radial-gradient(2px 2px at 235px 80px, rgba(255,255,255,0.75), transparent),
                radial-gradient(2.5px 2.5px at 295px 45px, rgba(255,255,255,0.85), transparent),
                radial-gradient(2px 2px at 355px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(2.5px 2.5px at 415px 25px, rgba(255,255,255,0.87), transparent),
                radial-gradient(2px 2px at 475px 85px, rgba(255,255,255,0.78), transparent),
                
                /* Regular Stars - Dense Field */
                radial-gradient(1.5px 1.5px at 15px 60px, rgba(255,255,255,0.7), transparent),
                radial-gradient(1px 1px at 45px 25px, rgba(255,255,255,0.6), transparent),
                radial-gradient(1.5px 1.5px at 75px 85px, rgba(255,255,255,0.75), transparent),
                radial-gradient(1px 1px at 105px 35px, rgba(255,255,255,0.65), transparent),
                radial-gradient(1.5px 1.5px at 135px 70px, rgba(255,255,255,0.7), transparent),
                radial-gradient(1px 1px at 165px 90px, rgba(255,255,255,0.6), transparent),
                radial-gradient(1.5px 1.5px at 195px 10px, rgba(255,255,255,0.75), transparent),
                radial-gradient(1px 1px at 225px 45px, rgba(255,255,255,0.65), transparent),
                radial-gradient(1.5px 1.5px at 255px 75px, rgba(255,255,255,0.7), transparent),
                radial-gradient(1px 1px at 285px 20px, rgba(255,255,255,0.6), transparent),
                radial-gradient(1.5px 1.5px at 315px 85px, rgba(255,255,255,0.75), transparent),
                radial-gradient(1px 1px at 345px 15px, rgba(255,255,255,0.65), transparent),
                radial-gradient(1.5px 1.5px at 375px 60px, rgba(255,255,255,0.7), transparent),
                radial-gradient(1px 1px at 405px 90px, rgba(255,255,255,0.62), transparent),
                radial-gradient(1.5px 1.5px at 435px 30px, rgba(255,255,255,0.72), transparent),
                radial-gradient(1px 1px at 465px 65px, rgba(255,255,255,0.68), transparent);
            background-repeat: repeat;
            background-size: 500px 120px, 450px 140px, 400px 110px, 550px 100px, 380px 150px;
            animation: cosmicTwinkle 4s ease-in-out infinite;
        }

        /* Nebula Layer */
        .stars::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                /* Colorful Distant Stars */
                radial-gradient(2px 2px at 40px 18px, rgba(173, 216, 230, 0.9), transparent),
                radial-gradient(1.8px 1.8px at 90px 48px, rgba(255, 182, 193, 0.8), transparent),
                radial-gradient(2px 2px at 140px 78px, rgba(221, 160, 221, 0.7), transparent),
                radial-gradient(1.5px 1.5px at 190px 28px, rgba(255, 255, 224, 0.85), transparent),
                radial-gradient(2px 2px at 240px 68px, rgba(176, 196, 222, 0.8), transparent),
                radial-gradient(1.8px 1.8px at 290px 38px, rgba(255, 228, 196, 0.7), transparent),
                radial-gradient(2px 2px at 340px 88px, rgba(230, 230, 250, 0.85), transparent),
                radial-gradient(1.5px 1.5px at 390px 18px, rgba(255, 215, 0, 0.6), transparent),
                radial-gradient(2px 2px at 440px 58px, rgba(255, 20, 147, 0.5), transparent),
                
                /* Nebula Clouds */
                radial-gradient(ellipse 80px 40px at 150px 100px, rgba(138, 43, 226, 0.15), transparent),
                radial-gradient(ellipse 60px 30px at 350px 150px, rgba(75, 0, 130, 0.12), transparent),
                radial-gradient(ellipse 100px 50px at 250px 50px, rgba(25, 25, 112, 0.1), transparent),
                
                /* Very faint background stars */
                radial-gradient(0.8px 0.8px at 30px 35px, rgba(255,255,255,0.3), transparent),
                radial-gradient(0.5px 0.5px at 70px 55px, rgba(255,255,255,0.35), transparent),
                radial-gradient(0.8px 0.8px at 120px 25px, rgba(255,255,255,0.25), transparent),
                radial-gradient(0.5px 0.5px at 160px 85px, rgba(255,255,255,0.2), transparent),
                radial-gradient(0.8px 0.8px at 210px 35px, rgba(255,255,255,0.3), transparent),
                radial-gradient(0.5px 0.5px at 250px 75px, rgba(255,255,255,0.35), transparent),
                radial-gradient(0.8px 0.8px at 300px 15px, rgba(255,255,255,0.25), transparent),
                radial-gradient(0.5px 0.5px at 330px 55px, rgba(255,255,255,0.2), transparent),
                radial-gradient(0.8px 0.8px at 370px 85px, rgba(255,255,255,0.3), transparent),
                radial-gradient(0.5px 0.5px at 420px 45px, rgba(255,255,255,0.25), transparent),
                radial-gradient(0.8px 0.8px at 460px 25px, rgba(255,255,255,0.3), transparent);
            background-repeat: repeat;
            background-size: 480px 160px, 520px 120px, 380px 140px;
            animation: nebulaFlow 8s ease-in-out infinite;
        }

        /* Constellation Layer */
        .stars::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                /* Constellation Stars - Connected patterns */
                radial-gradient(1.5px 1.5px at 80px 80px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1.2px 1.2px at 100px 90px, rgba(255,255,255,0.7), transparent),
                radial-gradient(1.8px 1.8px at 120px 75px, rgba(255,255,255,0.85), transparent),
                radial-gradient(1px 1px at 135px 85px, rgba(255,255,255,0.65), transparent),
                radial-gradient(1.5px 1.5px at 150px 95px, rgba(255,255,255,0.75), transparent),
                
                /* Big Dipper Pattern */
                radial-gradient(2px 2px at 300px 120px, rgba(255,255,255,0.9), transparent),
                radial-gradient(1.8px 1.8px at 320px 115px, rgba(255,255,255,0.85), transparent),
                radial-gradient(2px 2px at 340px 125px, rgba(255,255,255,0.9), transparent),
                radial-gradient(1.5px 1.5px at 360px 130px, rgba(255,255,255,0.8), transparent),
                radial-gradient(2px 2px at 380px 120px, rgba(255,255,255,0.9), transparent),
                radial-gradient(1.8px 1.8px at 400px 135px, rgba(255,255,255,0.85), transparent),
                radial-gradient(2px 2px at 420px 140px, rgba(255,255,255,0.9), transparent),
                
                /* Additional micro stars for ultra-dense effect */
                radial-gradient(0.4px 0.4px at 10px 20px, rgba(255,255,255,0.2), transparent),
                radial-gradient(0.3px 0.3px at 60px 40px, rgba(255,255,255,0.25), transparent),
                radial-gradient(0.4px 0.4px at 110px 60px, rgba(255,255,255,0.2), transparent),
                radial-gradient(0.3px 0.3px at 160px 10px, rgba(255,255,255,0.15), transparent),
                radial-gradient(0.4px 0.4px at 220px 50px, rgba(255,255,255,0.2), transparent),
                radial-gradient(0.3px 0.3px at 270px 70px, rgba(255,255,255,0.25), transparent),
                radial-gradient(0.4px 0.4px at 320px 20px, rgba(255,255,255,0.2), transparent),
                radial-gradient(0.3px 0.3px at 370px 90px, rgba(255,255,255,0.15), transparent),
                radial-gradient(0.4px 0.4px at 420px 30px, rgba(255,255,255,0.2), transparent),
                radial-gradient(0.3px 0.3px at 470px 80px, rgba(255,255,255,0.18), transparent);
            background-repeat: repeat;
            background-size: 500px 140px, 450px 160px;
            animation: constellationGlow 12s ease-in-out infinite;
        }

        @keyframes cosmicTwinkle {
            0%, 100% { 
                opacity: 1; 
                filter: brightness(1) contrast(1);
            }
            15% { 
                opacity: 0.8; 
                filter: brightness(1.1) contrast(1.1);
            }
            30% { 
                opacity: 0.9; 
                filter: brightness(0.95) contrast(1.05);
            }
            45% { 
                opacity: 0.6; 
                filter: brightness(1.15) contrast(1.2);
            }
            60% { 
                opacity: 0.85; 
                filter: brightness(1.05) contrast(1.1);
            }
            75% { 
                opacity: 0.7; 
                filter: brightness(1.2) contrast(1.15);
            }
        }

        @keyframes nebulaFlow {
            0%, 100% { 
                opacity: 0.6; 
                transform: translateX(0) translateY(0) scale(1);
            }
            25% { 
                opacity: 0.8; 
                transform: translateX(5px) translateY(-3px) scale(1.02);
            }
            50% { 
                opacity: 0.7; 
                transform: translateX(-3px) translateY(5px) scale(0.98);
            }
            75% { 
                opacity: 0.9; 
                transform: translateX(3px) translateY(-2px) scale(1.01);
            }
        }

        @keyframes constellationGlow {
            0%, 100% { 
                opacity: 0.4; 
                filter: hue-rotate(0deg);
            }
            33% { 
                opacity: 0.7; 
                filter: hue-rotate(30deg);
            }
            66% { 
                opacity: 0.5; 
                filter: hue-rotate(-30deg);
            }
        }

        /* Enhanced Shooting Stars */
        .shooting-star {
            position: absolute;
            width: 3px;
            height: 3px;
            background: linear-gradient(45deg, #ffffff, #00bfff);
            border-radius: 50%;
            box-shadow: 
                0 0 8px 3px rgba(255, 255, 255, 0.9),
                0 0 16px 6px rgba(0, 191, 255, 0.6),
                0 0 24px 9px rgba(255, 255, 255, 0.3);
            animation: meteorShower 6s linear infinite;
        }

        .shooting-star::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            height: 2px;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.8), transparent);
            transform: translateX(-50px) translateY(-50px) rotate(45deg);
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        @keyframes meteorShower {
            0% {
                transform: translateX(-150px) translateY(-150px) scale(0);
                opacity: 0;
            }
            5% {
                opacity: 1;
                transform: translateX(-100px) translateY(-100px) scale(1);
            }
            95% {
                opacity: 1;
                transform: translateX(calc(100vw + 50px)) translateY(calc(100vh + 50px)) scale(1);
            }
            100% {
                transform: translateX(calc(100vw + 100px)) translateY(calc(100vh + 100px)) scale(0);
                opacity: 0;
            }
        }

        /* Aurora Effects */
        .aurora {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: linear-gradient(
                180deg,
                rgba(0, 255, 150, 0.1) 0%,
                rgba(0, 150, 255, 0.08) 25%,
                rgba(150, 0, 255, 0.06) 50%,
                rgba(255, 0, 150, 0.04) 75%,
                transparent 100%
            );
            animation: auroraWave 15s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes auroraWave {
            0%, 100% { 
                opacity: 0.3; 
                transform: skewX(0deg);
            }
            25% { 
                opacity: 0.6; 
                transform: skewX(2deg);
            }
            50% { 
                opacity: 0.4; 
                transform: skewX(-1deg);
            }
            75% { 
                opacity: 0.7; 
                transform: skewX(1deg);
            }
        }

        /* Space with Planets Background */
        .space-planets-background {
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            position: relative;
        }

        .planet {
            position: absolute;
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        .planet-1 {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at 30% 30%, #ff6b9d, #c44569);
            top: 20%;
            right: 15%;
            animation-delay: 0s;
        }

        .planet-2 {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #8b5cf6, #5b21b6);
            bottom: 30%;
            left: 10%;
            animation-delay: 2s;
        }

        .planet-3 {
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #00d4ff, #0284c7);
            top: 50%;
            left: 50%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        /* Animated Background */
        .animated-background {
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            position: relative;
        }

        .animated-shape {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-pink), var(--primary-purple));
            opacity: 0.1;
            animation: morphShapes 8s ease-in-out infinite;
        }

        .shape-1 {
            width: 100px;
            height: 100px;
            top: 20%;
            left: 20%;
            animation-delay: 0s;
        }

        .shape-2 {
            width: 150px;
            height: 150px;
            bottom: 20%;
            right: 20%;
            animation-delay: 2s;
        }

        .shape-3 {
            width: 80px;
            height: 80px;
            top: 60%;
            left: 60%;
            animation-delay: 4s;
        }

        @keyframes morphShapes {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                border-radius: 50%;
            }
            25% {
                transform: scale(1.2) rotate(90deg);
                border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            }
            50% {
                transform: scale(0.8) rotate(180deg);
                border-radius: 70% 30% 30% 70% / 70% 70% 30% 30%;
            }
            75% {
                transform: scale(1.1) rotate(270deg);
                border-radius: 50% 50% 25% 75% / 25% 75% 50% 50%;
            }
        }

        /* ===== TOP LAYER: FLOATING GLASS UI INTERFACE (3mm Above) ===== */
        
        .glass-layer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            transform: translateZ(3mm);
            transform-style: preserve-3d;
            will-change: transform;
            pointer-events: auto;
            
            /* Enhanced Glass Floating Effect */
            box-shadow: 
                0 0 0 1px rgba(255, 255, 255, 0.02),
                0 3mm 6mm rgba(0, 0, 0, 0.15),
                0 1mm 3mm rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Custom Background Upload */
        .background-upload-area {
            border: 2px dashed rgba(255, 107, 157, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            background: rgba(255, 107, 157, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
        }

        .background-upload-area:hover {
            border-color: rgba(255, 107, 157, 0.5);
            background: rgba(255, 107, 157, 0.1);
        }

        .background-upload-area.dragover {
            border-color: var(--primary-pink);
            background: rgba(255, 107, 157, 0.15);
            transform: scale(1.02);
        }

        .background-preview {
            max-width: 100%;
            max-height: 120px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .size-indicator {
            background: rgba(255, 107, 157, 0.1);
            border: 1px solid rgba(255, 107, 157, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            margin: 5px;
            font-size: 11px;
            color: var(--primary-pink);
        }

        /* Custom Video Background */
        .custom-background {
            background: #000011;
            position: relative;
        }

        .custom-background video,
        .custom-background img {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translateX(-50%) translateY(-50%);
            object-fit: cover;
            opacity: 0.6;
        }

        /* Auth Screen with Enhanced Floating Glass Effect */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            padding: 20px;
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.3);
            transform: translateZ(2mm);
        }

        .auth-container {
            background: rgba(15, 15, 15, 0.15);
            backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 25px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 
                0 6mm 12mm rgba(0, 0, 0, 0.25),
                0 2mm 6mm rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 0 20px rgba(255, 255, 255, 0.05);
            max-width: 350px;
            width: 100%;
            transform: translateZ(1mm);
            position: relative;
        }

        .auth-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.1) 0%,
                rgba(255, 255, 255, 0.05) 25%,
                rgba(255, 255, 255, 0.02) 50%,
                rgba(255, 255, 255, 0.05) 75%,
                rgba(255, 255, 255, 0.1) 100%
            );
            border-radius: 25px;
            pointer-events: none;
            z-index: -1;
        }

        .auth-logo {
            font-size: 48px;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }

        .auth-title {
            font-size: 28px;
            font-weight: 300;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .auth-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .auth-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .auth-btn.google {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            box-shadow: 0 8px 32px rgba(255, 255, 255, 0.1);
        }

        .auth-btn.facebook {
            background: rgba(24, 119, 242, 0.8);
            color: #fff;
            box-shadow: 0 8px 32px rgba(24, 119, 242, 0.3);
        }

        .auth-btn.phone {
            background: rgba(255, 107, 157, 0.8);
            color: #fff;
            box-shadow: 0 8px 32px rgba(255, 107, 157, 0.3);
        }

        .auth-btn.test {
            background: rgba(102, 102, 102, 0.8);
            color: white;
            box-shadow: 0 8px 32px rgba(102, 102, 102, 0.3);
        }

        .auth-btn:hover {
            transform: translateY(-2px) translateZ(2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.3);
        }

        /* Main App with Glass Effect */
        .phone-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .glass-interface {
            width: 100%;
            max-width: 400px;
            height: calc(100vh - 20px);
            background: rgba(15, 15, 15, 0.12);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 25px;
            box-shadow: 
                0 8mm 16mm rgba(0, 0, 0, 0.25),
                0 2mm 8mm rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 0 20px rgba(255, 255, 255, 0.05),
                0 0 80px rgba(255, 107, 157, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transform: translateZ(0.5mm);
        }

        .glass-interface::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.1) 0%,
                rgba(255, 255, 255, 0.05) 25%,
                rgba(255, 255, 255, 0.02) 50%,
                rgba(255, 255, 255, 0.05) 75%,
                rgba(255, 255, 255, 0.1) 100%
            );
            border-radius: 25px;
            pointer-events: none;
            z-index: 1;
        }

        .glass-header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: calc(var(--safe-area-top) + 20px) 25px 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.12);
            background: rgba(15, 15, 15, 0.08);
            backdrop-filter: blur(25px) saturate(180%);
            transform: translateZ(0.2mm);
            box-shadow: 
                0 1mm 3mm rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .logo-section {
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .logo-text {
            font-size: 26px;
            font-weight: 200;
            color: var(--text-primary);
            letter-spacing: -1px;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.4);
        }

        .logo-slogan {
            font-size: 10px;
            color: var(--primary-pink);
            margin-top: -2px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.9;
            animation: pulse 3s infinite;
            text-shadow: 0 0 10px rgba(255, 107, 157, 0.6);
        }

        .logo-subtitle {
            font-size: 9px;
            color: var(--text-secondary);
            margin-top: 2px;
            opacity: 0.8;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .header-btn {
            width: 30px;
            height: 30px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
            transition: all 0.3s ease;
            position: relative;
        }

        .header-btn:hover {
            background: rgba(255, 107, 157, 0.15);
            border-color: var(--primary-pink);
            transform: scale(1.1) translateZ(1px);
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.3);
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 16px;
            height: 16px;
            background: var(--primary-pink);
            border-radius: 50%;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            box-shadow: 0 0 10px rgba(255, 107, 157, 0.5);
        }

        .glass-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            position: relative;
            z-index: 2;
        }

        .glass-section {
            padding: 15px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px) saturate(180%);
            position: relative;
            transform: translateZ(0.1mm);
            z-index: 2;
        }

        .glass-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.02) 0%,
                rgba(255, 255, 255, 0.05) 50%,
                rgba(255, 255, 255, 0.02) 100%
            );
            pointer-events: none;
            z-index: -1;
        }

        /* ===== RIGHT OVERLAY - INSTAGRAM/TIKTOK STYLE ===== */
        
        .right-overlay {
            position: fixed;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 20px;
            opacity: 0.9;
            transition: opacity 0.3s ease;
        }

        .right-overlay:hover {
            opacity: 1;
        }

        .overlay-icon {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: floatIcon 3s ease-in-out infinite;
        }

        .overlay-icon:nth-child(1) { animation-delay: 0s; }
        .overlay-icon:nth-child(2) { animation-delay: 0.5s; }
        .overlay-icon:nth-child(3) { animation-delay: 1s; }
        .overlay-icon:nth-child(4) { animation-delay: 1.5s; }
        .overlay-icon:nth-child(5) { animation-delay: 2s; }
        .overlay-icon:nth-child(6) { animation-delay: 2.5s; }

        @keyframes floatIcon {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .overlay-icon:hover {
            transform: scale(1.1) translateY(-3px);
        }

        .overlay-icon:hover .overlay-icon-bg {
            background: rgba(255, 107, 157, 0.2);
            border-color: var(--primary-pink);
            box-shadow: 0 0 25px rgba(255, 107, 157, 0.4);
        }

        .overlay-icon-bg {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(15, 15, 15, 0.6);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .overlay-notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 18px;
            height: 18px;
            background: var(--primary-pink);
            border-radius: 50%;
            font-size: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            box-shadow: 0 0 10px rgba(255, 107, 157, 0.5);
            border: 2px solid rgba(15, 15, 15, 0.8);
        }

        .overlay-label {
            margin-top: 6px;
            font-size: 10px;
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
            opacity: 0.8;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            background: rgba(0, 0, 0, 0.4);
            padding: 2px 6px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 50px;
        }

        /* Enhanced Modal System with Floating Glass Effect */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px;
            transform: translateZ(1mm);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: rgba(15, 15, 15, 0.15);
            backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 20px;
            padding: 25px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            width: 100%;
            max-width: 400px;
            box-shadow: 
                0 6mm 12mm rgba(0, 0, 0, 0.3),
                0 2mm 6mm rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 0 15px rgba(255, 255, 255, 0.05);
            transform: translateZ(1mm);
            position: relative;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.08) 0%,
                rgba(255, 255, 255, 0.03) 50%,
                rgba(255, 255, 255, 0.08) 100%
            );
            border-radius: 20px;
            pointer-events: none;
            z-index: -1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            color: var(--text-primary);
            transform: scale(1.1);
        }

        /* Enhanced Buttons */
        .btn-primary {
            background: linear-gradient(145deg, rgba(255, 107, 157, 0.8), rgba(196, 69, 105, 0.8));
            backdrop-filter: blur(20px);
            color: #fff;
            border: 1px solid rgba(255, 107, 157, 0.3);
            padding: 16px 24px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 
                0 6px 20px rgba(255, 107, 157, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-3px) translateZ(2px);
            box-shadow: 
                0 8px 25px rgba(255, 107, 157, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px) translateZ(1px);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
        }

        /* Challenge Cards with Enhanced Glass Effect */
        .challenge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .challenge-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .challenge-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-5px) translateZ(3px);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(255, 107, 157, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .challenge-category-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Form Elements with Glass Effect */
        .form-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-pink);
            box-shadow: 0 0 0 2px rgba(255, 107, 157, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        /* Task and Progress Elements */
        .task-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .task-item.completed {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .task-item.overdue {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-pink), var(--primary-purple));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* User Stats Display */
        .user-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(15px);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-pink);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Group and Community Elements */
        .group-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .group-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
        }

        .group-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .group-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-pink), var(--primary-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .challenge-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .right-overlay {
                right: 10px;
                gap: 15px;
                transform: translateY(-50%) scale(0.9);
            }
            
            .overlay-icon-bg {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .glass-interface {
                max-width: 100%;
                height: 100vh;
                border-radius: 0;
                margin: 0;
            }
            
            .phone-container {
                padding: 0;
            }
            
            .right-overlay {
                right: 8px;
                gap: 12px;
                transform: translateY(-50%) scale(0.8);
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
            }
            50% { 
                opacity: 0.8; 
                transform: scale(1.02);
            }
        }
    </style>
</head>
<body>
    <!-- Bottom Layer: Animated Backgrounds -->
    <div class="background-layer">
        <!-- Space with Blinking Stars -->
        <div class="background-content space-background active" id="spaceBackground">
            <div class="aurora"></div>
            <div class="stars"></div>
            <div class="shooting-star" style="top: 15%; left: 5%; animation-delay: 0s;"></div>
            <div class="shooting-star" style="top: 35%; left: 20%; animation-delay: 1.5s;"></div>
            <div class="shooting-star" style="top: 60%; left: 30%; animation-delay: 2s;"></div>
            <div class="shooting-star" style="top: 25%; left: 50%; animation-delay: 3s;"></div>
            <div class="shooting-star" style="top: 80%; left: 60%; animation-delay: 4s;"></div>
            <div class="shooting-star" style="top: 45%; left: 75%; animation-delay: 5s;"></div>
            <div class="shooting-star" style="top: 70%; left: 85%; animation-delay: 6s;"></div>
            <div class="shooting-star" style="top: 30%; left: 10%; animation-delay: 7s;"></div>
            <div class="shooting-star" style="top: 65%; left: 40%; animation-delay: 8s;"></div>
            <div class="shooting-star" style="top: 20%; left: 70%; animation-delay: 9s;"></div>
            <div class="shooting-star" style="top: 85%; left: 25%; animation-delay: 10s;"></div>
            <div class="shooting-star" style="top: 40%; left: 90%; animation-delay: 11s;"></div>
        </div>

        <!-- Space with Planets -->
        <div class="background-content space-planets-background" id="spacePlanetsBackground">
            <div class="stars"></div>
            <div class="planet planet-1"></div>
            <div class="planet planet-2"></div>
            <div class="planet planet-3"></div>
        </div>

        <!-- Custom Background -->
        <div class="background-content custom-background" id="customBackground">
            <div class="stars"></div>
            <video id="customBackgroundVideo" autoplay muted loop style="display: none;"></video>
            <img id="customBackgroundImage" style="display: none;">
        </div>
    </div>

    <!-- Top Layer: Glass UI Interface -->
    <div class="glass-layer">
        <!-- Auth Screen -->
        <div id="authScreen" class="auth-screen">
            <div class="auth-container">
                <div class="auth-logo">üöÄ</div>
                <div class="auth-title">Welcome to JomBro</div>
                <div class="auth-subtitle">Connect with friends and tackle challenges together!</div>
                
                <div id="errorMessage" class="error-message" style="display: none;"></div>
                <div id="successMessage" class="success-message" style="display: none;"></div>
                
                <!-- Main Auth Screen -->
                <div id="mainAuth">
                    <button class="auth-btn google" onclick="signInWithGoogle()">
                        üîç Continue with Google
                    </button>
                    
                    <button class="auth-btn facebook" onclick="signInWithFacebook()">
                        üìò Continue with Facebook
                    </button>
                    
                    <button class="auth-btn phone" onclick="showPhoneForm()">
                        üì± Continue with Phone
                    </button>
                    
                    <button class="auth-btn test" onclick="signInAnonymously()">
                        üß™ Test Mode (Skip Login)
                    </button>
                </div>

                <!-- Phone Form -->
                <div id="phoneForm" style="display: none; margin-top: 20px;">
                    <input type="tel" id="phoneInput" class="form-input" placeholder="+60123456789" required>
                    <div id="recaptcha-container"></div>
                    <input type="text" id="otpInput" class="form-input" placeholder="Enter OTP" style="display:none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                        <button class="btn-secondary" onclick="showMainAuth()">Back</button>
                        <button class="btn-primary" id="phoneSubmitBtn" onclick="signInWithPhone()">Send OTP</button>
                    </div>
                </div>

                <!-- User Info (After Login) -->
                <div id="userInfo" style="display: none;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">Welcome!</h3>
                    <p id="userDetails" style="color: var(--text-secondary); margin-bottom: 20px;"></p>
                    <button class="btn-primary" onclick="signOut()">Sign Out</button>
                </div>
                
                <div style="margin-top: 20px; font-size: 12px; color: var(--text-secondary);">
                    By continuing, you agree to our Terms & Privacy Policy
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="mainApp" class="phone-container" style="display: none;">
            <div class="glass-interface">
                <!-- Header -->
                <div class="glass-header">
                    <div class="logo-section" onclick="showProfile()">
                        <div class="logo-text">JomBro</div>
                        <div class="logo-slogan">Let's Go! Let's Go!</div>
                        <div class="logo-subtitle" id="userDisplayName">Loading...</div>
                    </div>
                    <div class="header-actions">
                        <div class="header-btn" onclick="showMyTasks()" title="My Tasks">
                            üìã
                            <div class="notification-badge" id="tasksNotifications" style="display: none;">2</div>
                        </div>
                        <div class="header-btn" onclick="showSettings()" title="Settings">‚öôÔ∏è</div>
                        <div class="header-btn" onclick="signOut()" title="Sign Out">üö™</div>
                    </div>
                </div>

                <div class="glass-content">
                    <!-- User Stats Dashboard -->
                    <div class="glass-section">
                        <div class="user-stats">
                            <div class="stat-card">
                                <div class="stat-value" id="userLevelDisplay">5</div>
                                <div class="stat-label">Level</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="userTokensDisplay">2,450</div>
                                <div class="stat-label">Tokens</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="userChallengesDisplay">12</div>
                                <div class="stat-label">Completed</div>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="levelProgress" style="width: 65%;"></div>
                        </div>
                        <div style="text-align: center; font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                            1,550 / 2,500 XP to Level 6
                        </div>
                    </div>

                    <!-- Live Players Section -->
                    <div class="glass-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 6px; height: 6px; background: #ff4757; border-radius: 50%; animation: pulse 2s infinite;"></div>
                                <span style="font-size: 13px; font-weight: 600;">LIVE</span>
                                <span style="background: rgba(0, 255, 150, 0.2); color: var(--success-green); padding: 2px 8px; border-radius: 10px; font-size: 10px;" id="onlineCount">5 online</span>
                            </div>
                            <div style="background: rgba(255, 107, 157, 0.1); border: 1px solid rgba(255, 107, 157, 0.3); color: var(--primary-pink); padding: 4px 10px; border-radius: 10px; font-size: 10px; font-weight: 600; cursor: pointer;" onclick="showProfile()">
                                <span id="userStatus">Level 5</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; overflow-x: auto; padding-bottom: 5px;" id="livePlayersContainer">
                            <!-- Real users appear here -->
                        </div>
                    </div>

                    <!-- Current Challenge Status -->
                    <div id="currentChallengeStatus" class="glass-section" style="display: none;">
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div>
                                    <div style="padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; background: var(--success-green); color: white; display: inline-block;">In Progress</div>
                                    <div style="font-size: 14px; font-weight: 600; margin-top: 5px;" id="currentChallengeTitle">Coffee Shop Poetry Challenge</div>
                                </div>
                                <div style="font-size: 18px; font-weight: 700; color: var(--primary-pink);" id="challengeTimer">2h 45m left</div>
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 10px;">
                                <span id="challengeProgress">Ready to submit proof</span>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn-secondary" onclick="openProofSubmission()" style="flex: 1;">üì∏ Submit Proof</button>
                                <button class="btn-secondary" onclick="viewChallenge()" style="flex: 1;">üëÄ View Details</button>
                            </div>
                        </div>
                    </div>

                    <!-- Main Challenge Selection -->
                    <div style="flex: 1; padding: 20px 25px; min-height: 300px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary);">üéØ Choose Your Challenge</h3>
                                <div style="background: rgba(255, 255, 255, 0.1); color: var(--text-secondary); padding: 4px 8px; border-radius: 8px; font-size: 10px; backdrop-filter: blur(10px);">8 Choices Available</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="refreshChallenges()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-primary); padding: 6px 8px; border-radius: 8px; cursor: pointer; font-size: 12px; backdrop-filter: blur(15px);" title="Generate New">‚ú®</button>
                            </div>
                        </div>
                        
                        <div id="challengeSelection" class="challenge-grid">
                            <!-- AI Generated challenges appear here -->
                        </div>
                    </div>

                    <!-- Action Section -->
                    <div style="padding: 18px 25px; background: linear-gradient(180deg, transparent 0%, rgba(255, 255, 255, 0.03) 100%); border-top: 1px solid rgba(255, 255, 255, 0.06);">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 5px; color: var(--text-primary);">Ready to become a champion?</div>
                            <div style="font-size: 11px; color: var(--text-secondary);">Complete challenges, upload proof, earn prestigious titles!</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <button class="btn-secondary" onclick="showProofGallery()" style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                                üèÜ Champions
                            </button>
                            <button class="btn-secondary" onclick="showMyTasks()" style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                                üìã My Tasks
                            </button>
                        </div>
                        <button class="btn-primary" id="mainActionBtn" onclick="showChallengeAgreement()">
                            üéØ START CHALLENGE
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Overlay - Instagram/TikTok Style -->
        <div class="right-overlay" id="rightOverlay" style="display: none;">
            <div class="overlay-icon" onclick="showProofGallery()" title="Hall of Champions">
                <div class="overlay-icon-bg">üèÜ</div>
                <div class="overlay-notification-badge" id="overlayGalleryNotifications">12</div>
                <div class="overlay-label">Champions</div>
            </div>
            
            <div class="overlay-icon" onclick="showFailureHall()" title="Hall of Shame">
                <div class="overlay-icon-bg">üö®</div>
                <div class="overlay-notification-badge" id="overlayFailureNotifications">3</div>
                <div class="overlay-label">Shame</div>
            </div>
            
            <div class="overlay-icon" onclick="toggleChat()" title="Group Chat">
                <div class="overlay-icon-bg">üí¨</div>
                <div class="overlay-notification-badge" id="overlayChatNotifications" style="display: none;">3</div>
                <div class="overlay-label">Chat</div>
            </div>
            
            <div class="overlay-icon" onclick="showOnlineUsers()" title="Online Users">
                <div class="overlay-icon-bg">üë•</div>
                <div class="overlay-notification-badge" id="overlayOnlineNotifications">5</div>
                <div class="overlay-label">Online</div>
            </div>
            
            <div class="overlay-icon" onclick="showGroups()" title="Groups">
                <div class="overlay-icon-bg">üè†</div>
                <div class="overlay-label">Groups</div>
            </div>
            
            <div class="overlay-icon" onclick="showEnhancedProfile()" title="Profile">
                <div class="overlay-icon-bg">üë§</div>
                <div class="overlay-label">Profile</div>
            </div>
        </div>

        <!-- Enhanced Modals -->

        <!-- Profile Modal -->
        <div id="profileModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <div class="modal-title">üë§ Your Profile</div>
                    <button class="modal-close" onclick="hideModal('profile')">&times;</button>
                </div>

                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(45deg, var(--primary-pink), var(--primary-purple)); display: flex; align-items: center; justify-content: center; font-size: 32px; margin: 0 auto 15px;">ü§ó</div>
                    <div style="font-size: 20px; font-weight: 600; margin-bottom: 5px;" id="profileDisplayName">Demo User</div>
                    <div style="font-size: 14px; color: var(--text-secondary);" id="profileEmail">demo@jombro.com</div>
                </div>

                <div class="user-stats" style="margin-bottom: 25px;">
                    <div class="stat-card">
                        <div class="stat-value" id="profileLevelDisplay">5</div>
                        <div class="stat-label">Level</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileTokensDisplay">2,450</div>
                        <div class="stat-label">Tokens</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileChallengesDisplay">12</div>
                        <div class="stat-label">Completed</div>
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px;">üèÜ Recent Achievements</div>
                    <div id="recentAchievements">
                        <!-- Achievements will be populated here -->
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px;">üé® Background Themes</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                        <button class="btn-secondary active" data-bg="space" onclick="switchBackground('space')" style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                            üåå Cosmic Night
                        </button>
                        <button class="btn-secondary" data-bg="custom" onclick="toggleCustomUpload()" style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                            üì∏ Custom Studio
                        </button>
                    </div>
                    
                    <div id="customUploadSection" style="display: none;">
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 15px; color: var(--primary-pink); display: flex; align-items: center; gap: 8px;">
                            üé¨ Background Studio
                            <div style="background: rgba(255, 107, 157, 0.1); color: var(--primary-pink); padding: 2px 6px; border-radius: 6px; font-size: 10px;">PRO</div>
                        </div>
                        
                        <!-- Background Slots -->
                        <div style="margin-bottom: 20px;">
                            <div style="font-size: 12px; font-weight: 600; margin-bottom: 10px; color: var(--text-secondary);">üìÇ Background Slots (3 Available)</div>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px;">
                                <div class="background-slot active" data-slot="1" onclick="selectBackgroundSlot(1)" style="border: 2px solid var(--primary-pink); border-radius: 8px; padding: 8px; text-align: center; cursor: pointer; background: rgba(255, 107, 157, 0.1);">
                                    <div style="font-size: 20px; margin-bottom: 4px;">üåå</div>
                                    <div style="font-size: 9px; color: var(--primary-pink);">Cosmic Night</div>
                                </div>
                                <div class="background-slot" data-slot="2" onclick="selectBackgroundSlot(2)" style="border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 8px; padding: 8px; text-align: center; cursor: pointer; background: rgba(255, 255, 255, 0.05);">
                                    <div style="font-size: 20px; margin-bottom: 4px;">üì∏</div>
                                    <div style="font-size: 9px; color: var(--text-secondary);">Custom 1</div>
                                </div>
                                <div class="background-slot" data-slot="3" onclick="selectBackgroundSlot(3)" style="border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 8px; padding: 8px; text-align: center; cursor: pointer; background: rgba(255, 255, 255, 0.05);">
                                    <div style="font-size: 20px; margin-bottom: 4px;">üé®</div>
                                    <div style="font-size: 9px; color: var(--text-secondary);">Custom 2</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Upload Area -->
                        <div class="background-upload-area" id="backgroundUploadArea" onclick="document.getElementById('backgroundFileInput').click()">
                            <div style="font-size: 32px; margin-bottom: 8px;">üé¨</div>
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 5px; color: var(--primary-pink);">Professional Upload Studio</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">Images, Videos, GIFs ‚Ä¢ AI Enhancement Available</div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; margin: 8px 0;">
                                <div class="size-indicator">üì± Mobile: 480x800px</div>
                                <div class="size-indicator">üíª Desktop: 1920x1080px</div>
                                <div class="size-indicator">üì∫ 4K: 3840x2160px</div>
                                <div class="size-indicator">üéÆ Ultra: 2560x1440px</div>
                            </div>
                            <div style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;">Max 100MB ‚Ä¢ Auto-optimization included ‚Ä¢ Drag & Drop supported</div>
                        </div>

                        <input type="file" id="backgroundFileInput" accept="image/*,video/*" onchange="handleBackgroundUpload(event)" style="display: none;">

                        <div id="backgroundPreviewContainer" style="display: none; margin-top: 15px;">
                            <div style="position: relative; margin-bottom: 15px;">
                                <img id="backgroundPreview" class="background-preview" style="display: none;">
                                <video id="backgroundVideoPreview" class="background-preview" controls style="display: none;"></video>
                                
                                <!-- Preview Controls Overlay -->
                                <div style="position: absolute; top: 5px; right: 5px; display: flex; gap: 5px;">
                                    <button onclick="toggleFullPreview()" style="background: rgba(0,0,0,0.7); border: none; color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer;">üîç Full</button>
                                    <button onclick="toggleMobilePreview()" style="background: rgba(0,0,0,0.7); border: none; color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer;">üì± Mobile</button>
                                </div>
                            </div>
                            
                            <!-- Professional Editing Tools -->
                            <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                                <div style="font-size: 12px; font-weight: 600; margin-bottom: 10px; color: var(--primary-pink);">üõ†Ô∏è Professional Tools</div>
                                
                                <!-- Effects & Filters -->
                                <div style="margin-bottom: 12px;">
                                    <div style="font-size: 11px; margin-bottom: 6px; color: var(--text-secondary);">‚ú® Visual Effects</div>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px;">
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <label style="font-size: 10px; color: var(--text-secondary);">Blur:</label>
                                            <input type="range" id="blurSlider" min="0" max="10" value="0" onchange="updateBackgroundEffect('blur', this.value)" style="flex: 1;">
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <label style="font-size: 10px; color: var(--text-secondary);">Opacity:</label>
                                            <input type="range" id="opacitySlider" min="20" max="100" value="60" onchange="updateBackgroundEffect('opacity', this.value)" style="flex: 1;">
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <label style="font-size: 10px; color: var(--text-secondary);">Brightness:</label>
                                            <input type="range" id="brightnessSlider" min="50" max="150" value="100" onchange="updateBackgroundEffect('brightness', this.value)" style="flex: 1;">
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <label style="font-size: 10px; color: var(--text-secondary);">Contrast:</label>
                                            <input type="range" id="contrastSlider" min="50" max="150" value="100" onchange="updateBackgroundEffect('contrast', this.value)" style="flex: 1;">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Quick Filters -->
                                <div style="margin-bottom: 12px;">
                                    <div style="font-size: 11px; margin-bottom: 6px; color: var(--text-secondary);">üé® Quick Filters</div>
                                    <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                        <button onclick="applyFilter('none')" class="filter-btn active" data-filter="none" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 4px 8px; border-radius: 6px; font-size: 9px; cursor: pointer;">Original</button>
                                        <button onclick="applyFilter('grayscale')" class="filter-btn" data-filter="grayscale" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 4px 8px; border-radius: 6px; font-size: 9px; cursor: pointer;">B&W</button>
                                        <button onclick="applyFilter('sepia')" class="filter-btn" data-filter="sepia" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 4px 8px; border-radius: 6px; font-size: 9px; cursor: pointer;">Vintage</button>
                                        <button onclick="applyFilter('hue-rotate')" class="filter-btn" data-filter="hue-rotate" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 4px 8px; border-radius: 6px; font-size: 9px; cursor: pointer;">Colorshift</button>
                                        <button onclick="applyFilter('saturate')" class="filter-btn" data-filter="saturate" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 4px 8px; border-radius: 6px; font-size: 9px; cursor: pointer;">Vibrant</button>
                                    </div>
                                </div>
                                
                                <!-- Performance Options -->
                                <div style="margin-bottom: 12px;">
                                    <div style="font-size: 11px; margin-bottom: 6px; color: var(--text-secondary);">‚ö° Performance</div>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                                        <label style="display: flex; align-items: center; gap: 6px; font-size: 10px; cursor: pointer;">
                                            <input type="checkbox" id="autoOptimize" checked onchange="updateOptimization('auto', this.checked)">
                                            üîß Auto-optimize
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 6px; font-size: 10px; cursor: pointer;">
                                            <input type="checkbox" id="highQuality" onchange="updateOptimization('quality', this.checked)">
                                            üéØ High Quality
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- AI Enhancement -->
                            <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(255, 107, 157, 0.1)); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 10px; padding: 12px; margin-bottom: 15px;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <div style="font-size: 12px; font-weight: 600; color: var(--primary-purple);">ü§ñ AI Enhancement</div>
                                    <div style="background: linear-gradient(45deg, var(--primary-purple), var(--primary-pink)); color: white; padding: 2px 6px; border-radius: 6px; font-size: 8px; font-weight: 700;">BETA</div>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px;">
                                    <button onclick="aiEnhance('upscale')" style="background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.4); color: var(--primary-purple); padding: 6px; border-radius: 6px; font-size: 9px; cursor: pointer;">üìà AI Upscale</button>
                                    <button onclick="aiEnhance('denoise')" style="background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.4); color: var(--primary-purple); padding: 6px; border-radius: 6px; font-size: 9px; cursor: pointer;">üßπ Denoise</button>
                                    <button onclick="aiEnhance('colorize')" style="background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.4); color: var(--primary-purple); padding: 6px; border-radius: 6px; font-size: 9px; cursor: pointer;">üé® Colorize</button>
                                    <button onclick="aiEnhance('style')" style="background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.4); color: var(--primary-purple); padding: 6px; border-radius: 6px; font-size: 9px; cursor: pointer;">‚ú® Stylize</button>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr 2fr; gap: 8px;">
                                <button class="btn-secondary" onclick="resetBackground()" style="font-size: 11px; padding: 8px;">üîÑ Reset</button>
                                <button class="btn-secondary" onclick="removeCustomBackground()" style="font-size: 11px; padding: 8px;">üóëÔ∏è Remove</button>
                                <button class="btn-primary" onclick="applyCustomBackground()" style="font-size: 11px; padding: 8px;">‚ú® Apply to Slot</button>
                            </div>
                        </div>
                        
                        <!-- Background Templates -->
                        <div style="margin-top: 20px;">
                            <div style="font-size: 12px; font-weight: 600; margin-bottom: 10px; color: var(--text-secondary);">üé≠ Quick Templates</div>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px;">
                                <button onclick="loadTemplate('gradient1')" style="height: 40px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.2); background: linear-gradient(45deg, #ff6b9d, #8b5cf6); cursor: pointer; font-size: 8px; color: white;">Sunset</button>
                                <button onclick="loadTemplate('gradient2')" style="height: 40px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.2); background: linear-gradient(45deg, #00d4ff, #0284c7); cursor: pointer; font-size: 8px; color: white;">Ocean</button>
                                <button onclick="loadTemplate('gradient3')" style="height: 40px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.2); background: linear-gradient(45deg, #10b981, #059669); cursor: pointer; font-size: 8px; color: white;">Forest</button>
                                <button onclick="loadTemplate('gradient4')" style="height: 40px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.2); background: linear-gradient(45deg, #f59e0b, #d97706); cursor: pointer; font-size: 8px; color: white;">Desert</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn-secondary" onclick="editProfile()">‚úèÔ∏è Edit Profile</button>
                    <button class="btn-primary" onclick="shareProfile()">üì§ Share Profile</button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content" style="max-width: 450px;">
                <div class="modal-header">
                    <div class="modal-title">‚öôÔ∏è Settings</div>
                    <button class="modal-close" onclick="hideModal('settings')">&times;</button>
                </div>

                <div style="margin-bottom: 25px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px;">üîî Notifications</div>
                    <div class="task-item">
                        <div>
                            <div style="font-weight: 600;">Challenge Reminders</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Get notified about challenge deadlines</div>
                        </div>
                        <input type="checkbox" id="challengeNotifications" checked onchange="updateSetting('challengeNotifications', this.checked)">
                    </div>
                    <div class="task-item">
                        <div>
                            <div style="font-weight: 600;">Friend Activities</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">See when friends complete challenges</div>
                        </div>
                        <input type="checkbox" id="friendNotifications" checked onchange="updateSetting('friendNotifications', this.checked)">
                    </div>
                    <div class="task-item">
                        <div>
                            <div style="font-weight: 600;">Group Chat Messages</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Receive chat notifications</div>
                        </div>
                        <input type="checkbox" id="chatNotifications" onchange="updateSetting('chatNotifications', this.checked)">
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px;">üéÆ Gameplay</div>
                    <div class="task-item">
                        <div>
                            <div style="font-weight: 600;">Auto-Save Progress</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Automatically save challenge progress</div>
                        </div>
                        <input type="checkbox" id="autoSave" checked onchange="updateSetting('autoSave', this.checked)">
                    </div>
                    <div class="task-item">
                        <div>
                            <div style="font-weight: 600;">Challenge Difficulty</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Preferred challenge difficulty level</div>
                        </div>
                        <select class="form-input" id="difficultyLevel" onchange="updateSetting('difficultyLevel', this.value)" style="margin: 0; width: 100px;">
                            <option value="easy">Easy</option>
                            <option value="medium" selected>Medium</option>
                            <option value="hard">Hard</option>
                            <option value="expert">Expert</option>
                        </select>
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px;">üîê Privacy</div>
                    <div class="task-item">
                        <div>
                            <div style="font-weight: 600;">Public Profile</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Allow others to view your profile</div>
                        </div>
                        <input type="checkbox" id="publicProfile" checked onchange="updateSetting('publicProfile', this.checked)">
                    </div>
                    <div class="task-item">
                        <div>
                            <div style="font-weight: 600;">Show Activity Status</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Display when you're online</div>
                        </div>
                        <input type="checkbox" id="showActivity" checked onchange="updateSetting('showActivity', this.checked)">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn-secondary" onclick="resetSettings()">üîÑ Reset</button>
                    <button class="btn-primary" onclick="saveSettings()">üíæ Save Settings</button>
                </div>
            </div>
        </div>

        <!-- My Tasks Modal -->
        <div id="myTasksModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <div class="modal-title">üìã My Tasks</div>
                    <button class="modal-close" onclick="hideModal('myTasks')">&times;</button>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 16px; font-weight: 600;">Active Challenges</div>
                        <div style="background: rgba(255, 107, 157, 0.1); color: var(--primary-pink); padding: 4px 8px; border-radius: 8px; font-size: 12px;">3 Active</div>
                    </div>
                    
                    <div id="activeTasks">
                        <!-- Active tasks will be populated here -->
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 16px; font-weight: 600;">Recently Completed</div>
                        <div style="background: rgba(16, 185, 129, 0.1); color: var(--success-green); padding: 4px 8px; border-radius: 8px; font-size: 12px;">5 Completed</div>
                    </div>
                    
                    <div id="completedTasks">
                        <!-- Completed tasks will be populated here -->
                    </div>
                </div>

                <button class="btn-primary" onclick="showChallengeSelection()">
                    üéØ Take New Challenge
                </button>
            </div>
        </div>

        <!-- Groups Modal -->
        <div id="groupsModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <div class="modal-title">üè† Groups</div>
                    <button class="modal-close" onclick="hideModal('groups')">&times;</button>
                </div>

                <div style="margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 16px; font-weight: 600;">My Groups</div>
                        <button class="btn-secondary" onclick="createGroup()" style="padding: 6px 12px; font-size: 12px;">‚ûï Create</button>
                    </div>
                    
                    <div id="myGroups">
                        <!-- User groups will be populated here -->
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px;">Discover Groups</div>
                    
                    <div id="discoverGroups">
                        <!-- Suggested groups will be populated here -->
                    </div>
                </div>

                <button class="btn-primary" onclick="exploreAllGroups()">
                    üîç Explore All Groups
                </button>
            </div>
        </div>

        <!-- Online Users Modal -->
        <div id="onlineUsersModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <div class="modal-title">üë• Online Users</div>
                    <button class="modal-close" onclick="hideModal('onlineUsers')">&times;</button>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 16px; font-weight: 600;">Currently Online</div>
                        <div style="background: rgba(16, 185, 129, 0.1); color: var(--success-green); padding: 4px 8px; border-radius: 8px; font-size: 12px;" id="onlineUsersCount">8 Users</div>
                    </div>
                    
                    <div id="onlineUsersList">
                        <!-- Online users will be populated here -->
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px;">Recently Active</div>
                    
                    <div id="recentUsersList">
                        <!-- Recently active users will be populated here -->
                    </div>
                </div>

                <button class="btn-primary" onclick="inviteFriends()">
                    üì§ Invite Friends
                </button>
            </div>
        </div>

        <!-- Challenge Proof Submission Modal -->
        <div id="proofSubmissionModal" class="modal">
            <div class="modal-content" style="max-width: 450px;">
                <div class="modal-header">
                    <div class="modal-title">üì∏ Submit Challenge Proof</div>
                    <button class="modal-close" onclick="hideModal('proofSubmission')">&times;</button>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px; color: var(--primary-pink);" id="proofChallengeTitle">Coffee Shop Poetry Challenge</div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 15px;">Upload a photo or video showing you completed this challenge!</div>
                </div>

                <div style="border: 2px dashed rgba(255, 107, 157, 0.3); border-radius: 15px; padding: 30px; text-align: center; background: rgba(255, 107, 157, 0.05); margin: 20px 0; cursor: pointer; transition: all 0.3s ease;" id="proofUploadArea" onclick="document.getElementById('proofFileInput').click()">
                    <div style="font-size: 48px; margin-bottom: 10px;">üì∏</div>
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px; color: var(--primary-pink);">Click to Upload Proof</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">Photos, Videos, or Screenshots accepted</div>
                    <div style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;">Max 50MB ‚Ä¢ JPG, PNG, MP4, MOV</div>
                </div>

                <input type="file" id="proofFileInput" accept="image/*,video/*" onchange="handleProofUpload(event)" style="display: none;">

                <div id="proofPreviewContainer" style="display: none;">
                    <img id="proofPreview" style="max-width: 100%; max-height: 200px; border-radius: 10px; margin-top: 15px; display: none;">
                    <video id="proofVideoPreview" controls style="max-width: 100%; max-height: 200px; border-radius: 10px; margin-top: 15px; display: none;"></video>
                    
                    <div style="width: 100%; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden; margin: 15px 0; display: none;" id="proofProgress">
                        <div style="height: 100%; background: linear-gradient(90deg, var(--primary-pink), var(--primary-purple)); width: 0%; transition: width 0.3s ease;" id="proofProgressBar"></div>
                    </div>
                </div>

                <div style="margin: 20px 0;">
                    <textarea class="form-input" id="proofDescription" placeholder="Describe your experience completing this challenge..." rows="3" style="resize: vertical;"></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn-secondary" onclick="hideModal('proofSubmission')">Cancel</button>
                    <button class="btn-primary" onclick="submitProof()" id="submitProofBtn">
                        üöÄ Submit Proof
                    </button>
                </div>
            </div>
        </div>

        <!-- Success Gallery Modal -->
        <div id="proofGalleryModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <div class="modal-title">üèÜ Hall of Champions</div>
                    <button class="modal-close" onclick="hideModal('proofGallery')">&times;</button>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 14px; color: var(--text-secondary);">Champion Submissions</div>
                        <div style="font-size: 12px; color: var(--primary-pink); background: rgba(255, 107, 157, 0.1); padding: 4px 8px; border-radius: 8px;">12 Heroes</div>
                    </div>
                    
                    <div id="fullGalleryContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; max-height: 400px; overflow-y: auto;">
                        <!-- Full gallery will be populated here -->
                    </div>
                </div>

                <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 12px; border: 1px solid rgba(255, 215, 0, 0.3);">
                    <div style="font-size: 24px; margin-bottom: 8px;">üëë</div>
                    <div style="font-size: 14px; font-weight: 600; color: var(--gold); margin-bottom: 5px;">Become a Champion</div>
                    <div style="font-size: 11px; color: var(--text-secondary);">Complete challenges and upload proof to earn prestigious titles!</div>
                </div>
            </div>
        </div>

        <!-- Enhanced Chat Interface -->
        <div id="chatInterface" style="position: fixed; bottom: 0; left: 0; right: 0; height: 60%; background: rgba(15, 15, 15, 0.3); backdrop-filter: blur(40px); border-top: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px 20px 0 0; transform: translateY(100%); transition: transform 0.3s ease; z-index: 1000; display: flex; flex-direction: column; box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5);">
            <div style="padding: 15px 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);" id="chatTitle">Challenge Group Chat</div>
                    <div style="font-size: 12px; color: var(--text-secondary);" id="chatMembers">5 members online</div>
                </div>
                <button style="background: none; border: none; color: var(--text-secondary); font-size: 18px; cursor: pointer;" onclick="toggleChat()">‚úï</button>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px;" id="chatMessages">
                <!-- Messages appear here -->
            </div>
            <div style="padding: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1); display: flex; gap: 10px; align-items: center;">
                <input type="text" style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 10px 15px; color: var(--text-primary); font-size: 14px; outline: none; backdrop-filter: blur(15px);" id="chatInput" placeholder="Type a message..." onkeypress="handleChatKeyPress(event)">
                <button style="background: var(--primary-pink); border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #fff; font-size: 16px;" onclick="sendMessage()">‚û§</button>
            </div>
        </div>
    </div>

    <script>
        // ===== APPLICATION STATE MANAGEMENT =====
        
        class AppState {
            constructor() {
                this.user = {
                    id: null,
                    name: 'Demo User',
                    email: 'demo@jombro.com',
                    level: 5,
                    tokens: 2450,
                    completedChallenges: 12,
                    xp: 1550,
                    avatar: 'ü§ó'
                };
                
                this.settings = {
                    challengeNotifications: true,
                    friendNotifications: true,
                    chatNotifications: false,
                    autoSave: true,
                    difficultyLevel: 'medium',
                    publicProfile: true,
                    showActivity: true,
                    background: 'space'
                };
                
                this.tasks = {
                    active: [],
                    completed: [],
                    overdue: []
                };
                
                this.groups = {
                    joined: [],
                    suggested: []
                };
                
                this.onlineUsers = [];
                this.recentUsers = [];
                
                this.loadState();
            }
            
            saveState() {
                try {
                    // We can't use localStorage in this environment, so we'll use in-memory storage
                    console.log('State saved to memory:', this);
                } catch (e) {
                    console.warn('Could not save state:', e);
                }
            }
            
            loadState() {
                try {
                    // Initialize with default data since we can't use localStorage
                    this.initializeDefaultData();
                } catch (e) {
                    console.warn('Could not load state, using defaults');
                    this.initializeDefaultData();
                }
            }
            
            initializeDefaultData() {
                // Initialize active tasks
                this.tasks.active = [
                    {
                        id: 1,
                        title: 'Coffee Shop Poetry Challenge',
                        description: 'Visit a coffee shop and ask for a poem',
                        deadline: new Date(Date.now() + 3600000 * 3), // 3 hours from now
                        progress: 75,
                        category: 'Social',
                        status: 'in-progress'
                    },
                    {
                        id: 2,
                        title: 'Morning Workout',
                        description: 'Complete 30-minute workout before 9 AM',
                        deadline: new Date(Date.now() + 3600000 * 18), // 18 hours from now
                        progress: 0,
                        category: 'Fitness',
                        status: 'pending'
                    },
                    {
                        id: 3,
                        title: 'Learn New Recipe',
                        description: 'Cook something you\'ve never made before',
                        deadline: new Date(Date.now() + 3600000 * 48), // 2 days from now
                        progress: 25,
                        category: 'Creative',
                        status: 'in-progress'
                    }
                ];
                
                // Initialize completed tasks
                this.tasks.completed = [
                    {
                        id: 4,
                        title: 'Street Art Photography',
                        description: 'Find and photograph 5 pieces of street art',
                        completedAt: new Date(Date.now() - 86400000), // 1 day ago
                        tokens: 500,
                        category: 'Adventure'
                    },
                    {
                        id: 5,
                        title: 'Random Acts of Kindness',
                        description: 'Perform 3 random acts of kindness',
                        completedAt: new Date(Date.now() - 172800000), // 2 days ago
                        tokens: 750,
                        category: 'Social'
                    }
                ];
                
                // Initialize groups
                this.groups.joined = [
                    {
                        id: 1,
                        name: 'Coffee Lovers',
                        description: 'For those who love coffee shop challenges',
                        members: 147,
                        avatar: '‚òï',
                        isActive: true
                    },
                    {
                        id: 2,
                        name: 'Fitness Warriors',
                        description: 'Workout challenges and motivation',
                        members: 89,
                        avatar: 'üí™',
                        isActive: true
                    }
                ];
                
                this.groups.suggested = [
                    {
                        id: 3,
                        name: 'Creative Minds',
                        description: 'Art, music, and creative challenges',
                        members: 203,
                        avatar: 'üé®',
                        category: 'Creative'
                    },
                    {
                        id: 4,
                        name: 'Adventure Seekers',
                        description: 'Explore your city with us',
                        members: 156,
                        avatar: 'üó∫Ô∏è',
                        category: 'Adventure'
                    },
                    {
                        id: 5,
                        name: 'Mindful Moments',
                        description: 'Meditation and mindfulness challenges',
                        members: 78,
                        avatar: 'üß†',
                        category: 'Mindfulness'
                    }
                ];
                
                // Initialize online users
                this.onlineUsers = [
                    { id: 1, name: 'Alex Chen', avatar: 'üòé', activity: 'Coffee Shop Challenge', level: 5, status: 'online' },
                    { id: 2, name: 'Maya Patel', avatar: 'üåü', activity: 'Sunrise Workout', level: 3, status: 'online' },
                    { id: 3, name: 'Jordan Kim', avatar: 'üöÄ', activity: 'Street Art Hunt', level: 7, status: 'online' },
                    { id: 4, name: 'Sam Wilson', avatar: 'üé®', activity: 'Reading in park', level: 2, status: 'online' },
                    { id: 5, name: 'Rio Martinez', avatar: '‚ö°', activity: 'Coding challenge', level: 6, status: 'online' },
                    { id: 6, name: 'Casey Wong', avatar: 'ü¶ã', activity: 'Food art creating', level: 4, status: 'online' },
                    { id: 7, name: 'Robin Lee', avatar: 'üî•', activity: 'Mystery exploration', level: 8, status: 'online' },
                    { id: 8, name: 'Taylor Swift', avatar: 'üí´', activity: 'Photo scavenger hunt', level: 3, status: 'online' }
                ];
                
                this.recentUsers = [
                    { id: 9, name: 'Emma Stone', avatar: 'üåô', activity: 'Last seen 2h ago', level: 4, status: 'offline' },
                    { id: 10, name: 'Chris Evans', avatar: '‚≠ê', activity: 'Last seen 5h ago', level: 6, status: 'offline' },
                    { id: 11, name: 'Zoe Clark', avatar: 'üéØ', activity: 'Last seen 1d ago', level: 2, status: 'offline' }
                ];
            }
            
            updateUser(updates) {
                Object.assign(this.user, updates);
                this.saveState();
                this.updateUserDisplay();
            }
            
            updateSettings(key, value) {
                this.settings[key] = value;
                this.saveState();
                console.log(`Setting ${key} updated to:`, value);
            }
            
            updateUserDisplay() {
                // Update all user display elements
                document.getElementById('userDisplayName').textContent = this.user.name;
                document.getElementById('userLevelDisplay').textContent = this.user.level;
                document.getElementById('userTokensDisplay').textContent = this.user.tokens.toLocaleString();
                document.getElementById('userChallengesDisplay').textContent = this.user.completedChallenges;
                document.getElementById('userStatus').textContent = `Level ${this.user.level}`;
                
                // Update profile modal if open
                if (document.getElementById('profileDisplayName')) {
                    document.getElementById('profileDisplayName').textContent = this.user.name;
                    document.getElementById('profileEmail').textContent = this.user.email;
                    document.getElementById('profileLevelDisplay').textContent = this.user.level;
                    document.getElementById('profileTokensDisplay').textContent = this.user.tokens.toLocaleString();
                    document.getElementById('profileChallengesDisplay').textContent = this.user.completedChallenges;
                }
                
                // Update level progress
                const nextLevelXP = (this.user.level + 1) * 1000;
                const progress = (this.user.xp / nextLevelXP) * 100;
                document.getElementById('levelProgress').style.width = `${Math.min(progress, 100)}%`;
            }
        }

        // Initialize global app state
        let appState = new AppState();

        // ===== ENHANCED MODAL SYSTEM =====
        
        const ModalManager = {
            openModals: new Set(),
            
            show(modalId) {
                const modal = document.getElementById(modalId + 'Modal');
                if (modal) {
                    modal.classList.add('show');
                    this.openModals.add(modalId);
                    
                    // Load modal content based on type
                    switch(modalId) {
                        case 'profile':
                            this.loadProfileModal();
                            break;
                        case 'settings':
                            this.loadSettingsModal();
                            break;
                        case 'myTasks':
                            this.loadTasksModal();
                            break;
                        case 'groups':
                            this.loadGroupsModal();
                            break;
                        case 'onlineUsers':
                            this.loadOnlineUsersModal();
                            break;
                    }
                }
            },
            
            hide(modalId) {
                const modal = document.getElementById(modalId + 'Modal');
                if (modal) {
                    modal.classList.remove('show');
                    this.openModals.delete(modalId);
                }
            },
            
            loadProfileModal() {
                appState.updateUserDisplay();
                
                // Load recent achievements
                const achievementsContainer = document.getElementById('recentAchievements');
                achievementsContainer.innerHTML = `
                    <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 10px; padding: 10px; margin: 5px 0;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 20px;">üèÜ</div>
                            <div>
                                <div style="font-weight: 600; color: var(--gold);">Challenge Genius</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Completed Coffee Shop Poetry with excellence</div>
                            </div>
                        </div>
                    </div>
                    <div style="background: rgba(192, 192, 192, 0.1); border: 1px solid rgba(192, 192, 192, 0.3); border-radius: 10px; padding: 10px; margin: 5px 0;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 20px;">ü•à</div>
                            <div>
                                <div style="font-weight: 600; color: var(--silver);">Super Achiever</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Completed Street Art Photography</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Set correct background button as active
                document.querySelectorAll('[data-bg]').forEach(btn => btn.classList.remove('active'));
                const currentBg = appState.settings.background || 'space';
                const activeBtn = document.querySelector(`[data-bg="${currentBg}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
            },
            
            loadSettingsModal() {
                // Update settings checkboxes and selects with current values
                document.getElementById('challengeNotifications').checked = appState.settings.challengeNotifications;
                document.getElementById('friendNotifications').checked = appState.settings.friendNotifications;
                document.getElementById('chatNotifications').checked = appState.settings.chatNotifications;
                document.getElementById('autoSave').checked = appState.settings.autoSave;
                document.getElementById('difficultyLevel').value = appState.settings.difficultyLevel;
                document.getElementById('publicProfile').checked = appState.settings.publicProfile;
                document.getElementById('showActivity').checked = appState.settings.showActivity;
            },
            
            loadTasksModal() {
                const activeContainer = document.getElementById('activeTasks');
                const completedContainer = document.getElementById('completedTasks');
                
                // Load active tasks
                activeContainer.innerHTML = appState.tasks.active.map(task => {
                    const timeLeft = this.getTimeLeft(task.deadline);
                    const isOverdue = new Date() > task.deadline;
                    
                    return `
                        <div class="task-item ${isOverdue ? 'overdue' : ''}" onclick="viewTask(${task.id})">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 4px;">${task.title}</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">${task.description}</div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-size: 11px; color: ${isOverdue ? 'var(--error-red)' : 'var(--warning-orange)'};">
                                        ${isOverdue ? '‚ö†Ô∏è Overdue' : `‚è∞ ${timeLeft}`}
                                    </div>
                                    <div style="font-size: 11px; color: var(--primary-pink);">${task.progress}% complete</div>
                                </div>
                                <div class="progress-bar" style="margin-top: 5px;">
                                    <div class="progress-fill" style="width: ${task.progress}%;"></div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Load completed tasks
                completedContainer.innerHTML = appState.tasks.completed.map(task => {
                    const timeAgo = this.getTimeAgo(task.completedAt);
                    
                    return `
                        <div class="task-item completed" onclick="viewCompletedTask(${task.id})">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 4px;">‚úÖ ${task.title}</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">${task.description}</div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-size: 11px; color: var(--success-green);">Completed ${timeAgo}</div>
                                    <div style="font-size: 11px; color: var(--primary-pink);">+${task.tokens} tokens</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            },
            
            loadGroupsModal() {
                const myGroupsContainer = document.getElementById('myGroups');
                const discoverContainer = document.getElementById('discoverGroups');
                
                // Load joined groups
                myGroupsContainer.innerHTML = appState.groups.joined.map(group => `
                    <div class="group-card" onclick="openGroup(${group.id})">
                        <div class="group-header">
                            <div class="group-avatar">${group.avatar}</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 4px;">${group.name}</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">${group.description}</div>
                                <div style="font-size: 11px; color: var(--primary-pink);">${group.members} members</div>
                            </div>
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: ${group.isActive ? 'var(--success-green)' : 'var(--text-secondary)'}; animation: ${group.isActive ? 'pulse 2s infinite' : 'none'};"></div>
                        </div>
                    </div>
                `).join('');
                
                // Load suggested groups
                discoverContainer.innerHTML = appState.groups.suggested.map(group => `
                    <div class="group-card" onclick="joinGroup(${group.id})">
                        <div class="group-header">
                            <div class="group-avatar">${group.avatar}</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 4px;">${group.name}</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">${group.description}</div>
                                <div style="font-size: 11px; color: var(--primary-pink);">${group.members} members</div>
                            </div>
                            <button class="btn-secondary" onclick="event.stopPropagation(); joinGroup(${group.id})" style="padding: 4px 8px; font-size: 10px;">Join</button>
                        </div>
                    </div>
                `).join('');
            },
            
            loadOnlineUsersModal() {
                const onlineContainer = document.getElementById('onlineUsersList');
                const recentContainer = document.getElementById('recentUsersList');
                
                document.getElementById('onlineUsersCount').textContent = `${appState.onlineUsers.length} Users`;
                
                // Load online users
                onlineContainer.innerHTML = appState.onlineUsers.map(user => `
                    <div style="display: flex; align-items: center; gap: 15px; padding: 10px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; margin: 5px 0; cursor: pointer;" onclick="viewUserProfile('${user.name}')">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(45deg, var(--primary-pink), var(--primary-purple)); display: flex; align-items: center; justify-content: center; font-size: 18px; position: relative;">
                            ${user.avatar}
                            <div style="position: absolute; bottom: 0; right: 0; width: 10px; height: 10px; background: var(--success-green); border: 2px solid rgba(15, 15, 15, 0.8); border-radius: 50%; animation: pulse 2s infinite;"></div>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; margin-bottom: 2px;">${user.name}</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 2px;">${user.activity}</div>
                            <div style="font-size: 10px; color: var(--primary-pink);">Level ${user.level}</div>
                        </div>
                        <button class="btn-secondary" onclick="event.stopPropagation(); sendMessage('${user.name}')" style="padding: 4px 8px; font-size: 10px;">üí¨ Chat</button>
                    </div>
                `).join('');
                
                // Load recent users
                recentContainer.innerHTML = appState.recentUsers.map(user => `
                    <div style="display: flex; align-items: center; gap: 15px; padding: 10px; background: rgba(255, 255, 255, 0.03); border-radius: 10px; margin: 5px 0; cursor: pointer; opacity: 0.7;" onclick="viewUserProfile('${user.name}')">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(45deg, var(--text-secondary), rgba(255, 255, 255, 0.3)); display: flex; align-items: center; justify-content: center; font-size: 18px;">
                            ${user.avatar}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; margin-bottom: 2px;">${user.name}</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 2px;">${user.activity}</div>
                            <div style="font-size: 10px; color: var(--text-secondary);">Level ${user.level}</div>
                        </div>
                    </div>
                `).join('');
            },
            
            getTimeLeft(deadline) {
                const now = new Date();
                const diff = deadline - now;
                
                if (diff <= 0) return 'Overdue';
                
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                if (hours > 24) {
                    const days = Math.floor(hours / 24);
                    return `${days}d ${hours % 24}h left`;
                } else if (hours > 0) {
                    return `${hours}h ${minutes}m left`;
                } else {
                    return `${minutes}m left`;
                }
            },
            
            getTimeAgo(date) {
                const now = new Date();
                const diff = now - date;
                
                const minutes = Math.floor(diff / (1000 * 60));
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                
                if (days > 0) return `${days}d ago`;
                if (hours > 0) return `${hours}h ago`;
                if (minutes > 0) return `${minutes}m ago`;
                return 'just now';
            }
        };

        // ===== ENHANCED FUNCTION IMPLEMENTATIONS =====

        // ===== ENHANCED BACKGROUND SYSTEM =====
        
        let customBackgroundFile = null;
        let customBackgroundType = null;
        let currentBackgroundSlot = 1;
        let backgroundSlots = {
            1: { type: 'default', name: 'Cosmic Night', active: true },
            2: { type: 'empty', name: 'Custom 1', active: false },
            3: { type: 'empty', name: 'Custom 2', active: false }
        };
        let currentFilters = {
            blur: 0,
            opacity: 60,
            brightness: 100,
            contrast: 100,
            filter: 'none'
        };

        // Background management
        function switchBackground(type) {
            // Update active button in profile modal
            document.querySelectorAll('[data-bg]').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`[data-bg="${type}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            // Hide all backgrounds
            document.querySelectorAll('.background-content').forEach(bg => bg.classList.remove('active'));
            
            // Show selected background
            switch(type) {
                case 'space':
                    document.getElementById('spaceBackground').classList.add('active');
                    break;
                case 'planets':
                    document.getElementById('spacePlanetsBackground').classList.add('active');
                    break;
                case 'custom':
                    document.getElementById('customBackground').classList.add('active');
                    break;
            }
            
            appState.updateSettings('background', type);
            showToast(`‚ú® Background changed to ${type === 'space' ? 'Cosmic Night' : type}!`, 'success');
        }

        window.toggleCustomUpload = function() {
            const uploadSection = document.getElementById('customUploadSection');
            const isVisible = uploadSection.style.display !== 'none';
            
            if (isVisible) {
                uploadSection.style.display = 'none';
                switchBackground('space');
            } else {
                uploadSection.style.display = 'block';
                updateBackgroundSlotDisplay();
            }
        };

        window.selectBackgroundSlot = function(slotNumber) {
            currentBackgroundSlot = slotNumber;
            
            // Update slot display
            document.querySelectorAll('.background-slot').forEach(slot => {
                slot.classList.remove('active');
                slot.style.border = '2px solid rgba(255, 255, 255, 0.2)';
                slot.style.background = 'rgba(255, 255, 255, 0.05)';
            });
            
            const activeSlot = document.querySelector(`[data-slot="${slotNumber}"]`);
            activeSlot.classList.add('active');
            activeSlot.style.border = '2px solid var(--primary-pink)';
            activeSlot.style.background = 'rgba(255, 107, 157, 0.1)';
            
            showToast(`üìÇ Selected slot ${slotNumber}: ${backgroundSlots[slotNumber].name}`, 'info');
        };

        function updateBackgroundSlotDisplay() {
            Object.keys(backgroundSlots).forEach(slotNum => {
                const slot = backgroundSlots[slotNum];
                const slotElement = document.querySelector(`[data-slot="${slotNum}"]`);
                if (slotElement) {
                    const icon = slotElement.querySelector('div:first-child');
                    const label = slotElement.querySelector('div:last-child');
                    
                    if (slot.type === 'default') {
                        icon.textContent = 'üåå';
                        label.textContent = 'Cosmic Night';
                        label.style.color = 'var(--primary-pink)';
                    } else if (slot.type === 'custom') {
                        icon.textContent = '‚úÖ';
                        label.textContent = slot.name;
                        label.style.color = 'var(--success-green)';
                    } else {
                        icon.textContent = slot.name.includes('1') ? 'üì∏' : 'üé®';
                        label.textContent = slot.name;
                        label.style.color = 'var(--text-secondary)';
                    }
                }
            });
        }

        window.handleBackgroundUpload = function(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file size (100MB max)
            if (file.size > 100 * 1024 * 1024) {
                showToast('‚ùå File too large! Maximum 100MB allowed.', 'error');
                return;
            }

            // Validate file type
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'video/mp4', 'video/mov', 'video/avi', 'video/webm'];
            if (!allowedTypes.includes(file.type)) {
                showToast('‚ùå Invalid file type! Only images and videos allowed.', 'error');
                return;
            }

            customBackgroundFile = file;
            customBackgroundType = file.type.startsWith('video/') ? 'video' : 'image';
            
            // Check image dimensions for optimal display
            if (customBackgroundType === 'image') {
                const img = new Image();
                img.onload = function() {
                    const width = img.width;
                    const height = img.height;
                    const aspectRatio = width / height;
                    
                    let sizeRecommendation = '';
                    let qualityRating = '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê';
                    
                    if (width >= 3840 && height >= 2160) {
                        sizeRecommendation = `üéØ Ultra 4K: ${width}x${height}px - Perfect for all devices!`;
                        qualityRating = 'üåü‚ú® PREMIUM QUALITY';
                    } else if (width >= 1920 && height >= 1080) {
                        sizeRecommendation = `‚úÖ HD Quality: ${width}x${height}px - Excellent for desktop!`;
                        qualityRating = '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê EXCELLENT';
                    } else if (width >= 1280 && height >= 720) {
                        sizeRecommendation = `üëç Good Quality: ${width}x${height}px - Great for mobile!`;
                        qualityRating = '‚≠ê‚≠ê‚≠ê‚≠ê GOOD';
                    } else {
                        sizeRecommendation = `üìè Current: ${width}x${height}px - Consider higher resolution for best quality.`;
                        qualityRating = '‚≠ê‚≠ê‚≠ê FAIR';
                    }
                    
                    if (aspectRatio < 1.5 || aspectRatio > 2.0) {
                        sizeRecommendation += `\nüìê Aspect ratio: ${aspectRatio.toFixed(2)}:1. Recommended: 16:9 (1.78:1) for optimal display.`;
                    }
                    
                    setTimeout(() => showToast(`${sizeRecommendation}\n${qualityRating}`, 'info'), 1000);
                };
                img.src = URL.createObjectURL(file);
            }
            
            // Show preview
            const previewContainer = document.getElementById('backgroundPreviewContainer');
            const imagePreview = document.getElementById('backgroundPreview');
            const videoPreview = document.getElementById('backgroundVideoPreview');
            
            previewContainer.style.display = 'block';
            
            if (customBackgroundType === 'video') {
                imagePreview.style.display = 'none';
                videoPreview.style.display = 'block';
                videoPreview.src = URL.createObjectURL(file);
            } else {
                videoPreview.style.display = 'none';
                imagePreview.style.display = 'block';
                imagePreview.src = URL.createObjectURL(file);
            }

            // Reset filters
            resetFilters();

            // Update upload area with file info
            const fileSizeMB = (file.size / (1024 * 1024)).toFixed(1);
            const uploadArea = document.getElementById('backgroundUploadArea');
            uploadArea.innerHTML = `
                <div style="font-size: 32px; margin-bottom: 8px;">‚úÖ</div>
                <div style="font-size: 14px; font-weight: 600; margin-bottom: 5px; color: var(--success-green);">Studio Ready!</div>
                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 5px;">${file.name}</div>
                <div style="display: flex; justify-content: center; gap: 8px; margin: 5px 0;">
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px; padding: 4px 8px; font-size: 10px; color: var(--success-green);">
                        üìä ${fileSizeMB}MB
                    </div>
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px; padding: 4px 8px; font-size: 10px; color: var(--success-green);">
                        ${customBackgroundType === 'video' ? 'üé•' : 'üñºÔ∏è'} ${customBackgroundType.toUpperCase()}
                    </div>
                </div>
                <div style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;">Click to change ‚Ä¢ Professional tools unlocked</div>
            `;

            showToast(`${customBackgroundType === 'video' ? 'üé• Video' : 'üñºÔ∏è Image'} loaded into studio!`, 'success');
        };

        // Background Effects System
        window.updateBackgroundEffect = function(effect, value) {
            currentFilters[effect] = value;
            applyFilters();
        };

        window.applyFilter = function(filterType) {
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'rgba(255, 255, 255, 0.1)';
            });
            
            const activeBtn = document.querySelector(`[data-filter="${filterType}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.style.background = 'rgba(255, 107, 157, 0.2)';
            }
            
            currentFilters.filter = filterType;
            applyFilters();
            showToast(`üé® ${filterType} filter applied!`, 'success');
        };

        function applyFilters() {
            const preview = document.getElementById('backgroundPreview');
            const videoPreview = document.getElementById('backgroundVideoPreview');
            
            let filterString = '';
            
            if (currentFilters.blur > 0) {
                filterString += `blur(${currentFilters.blur}px) `;
            }
            
            if (currentFilters.brightness !== 100) {
                filterString += `brightness(${currentFilters.brightness}%) `;
            }
            
            if (currentFilters.contrast !== 100) {
                filterString += `contrast(${currentFilters.contrast}%) `;
            }
            
            switch (currentFilters.filter) {
                case 'grayscale':
                    filterString += 'grayscale(100%) ';
                    break;
                case 'sepia':
                    filterString += 'sepia(80%) ';
                    break;
                case 'hue-rotate':
                    filterString += 'hue-rotate(180deg) ';
                    break;
                case 'saturate':
                    filterString += 'saturate(150%) ';
                    break;
            }
            
            const opacity = currentFilters.opacity / 100;
            
            if (preview) {
                preview.style.filter = filterString;
                preview.style.opacity = opacity;
            }
            if (videoPreview) {
                videoPreview.style.filter = filterString;
                videoPreview.style.opacity = opacity;
            }
        }

        function resetFilters() {
            currentFilters = {
                blur: 0,
                opacity: 60,
                brightness: 100,
                contrast: 100,
                filter: 'none'
            };
            
            // Reset sliders
            document.getElementById('blurSlider').value = 0;
            document.getElementById('opacitySlider').value = 60;
            document.getElementById('brightnessSlider').value = 100;
            document.getElementById('contrastSlider').value = 100;
            
            // Reset filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'rgba(255, 255, 255, 0.1)';
            });
            document.querySelector('[data-filter="none"]').classList.add('active');
            document.querySelector('[data-filter="none"]').style.background = 'rgba(255, 107, 157, 0.2)';
            
            applyFilters();
        }

        // Preview Controls
        window.toggleFullPreview = function() {
            const preview = document.getElementById('backgroundPreview');
            const videoPreview = document.getElementById('backgroundVideoPreview');
            
            const element = preview.style.display !== 'none' ? preview : videoPreview;
            
            if (element.style.maxHeight === '400px') {
                element.style.maxHeight = '120px';
                showToast('üì± Compact preview mode', 'info');
            } else {
                element.style.maxHeight = '400px';
                showToast('üîç Full preview mode', 'info');
            }
        };

        window.toggleMobilePreview = function() {
            const preview = document.getElementById('backgroundPreview');
            const videoPreview = document.getElementById('backgroundVideoPreview');
            
            const element = preview.style.display !== 'none' ? preview : videoPreview;
            
            if (element.style.width === '200px') {
                element.style.width = '100%';
                element.style.height = 'auto';
                showToast('üíª Desktop preview mode', 'info');
            } else {
                element.style.width = '200px';
                element.style.height = '350px';
                element.style.objectFit = 'cover';
                showToast('üì± Mobile preview mode', 'info');
            }
        };

        // AI Enhancement (Simulated)
        window.aiEnhance = function(type) {
            if (!customBackgroundFile) {
                showToast('‚ùå Please upload a file first!', 'error');
                return;
            }
            
            const messages = {
                'upscale': 'üìà AI Upscaling in progress... This may take a few moments.',
                'denoise': 'üßπ AI Noise reduction processing...',
                'colorize': 'üé® AI Colorization enhancing...',
                'style': '‚ú® AI Style transfer applying...'
            };
            
            showToast(messages[type], 'info');
            
            // Simulate AI processing
            setTimeout(() => {
                const effects = {
                    'upscale': () => {
                        currentFilters.brightness = 110;
                        currentFilters.contrast = 110;
                    },
                    'denoise': () => {
                        currentFilters.blur = 0.5;
                        currentFilters.contrast = 105;
                    },
                    'colorize': () => {
                        currentFilters.filter = 'saturate';
                        currentFilters.brightness = 105;
                    },
                    'style': () => {
                        currentFilters.filter = 'hue-rotate';
                        currentFilters.contrast = 120;
                    }
                };
                
                effects[type]();
                
                // Update sliders
                document.getElementById('brightnessSlider').value = currentFilters.brightness;
                document.getElementById('contrastSlider').value = currentFilters.contrast;
                document.getElementById('blurSlider').value = currentFilters.blur;
                
                applyFilters();
                showToast(`ü§ñ AI ${type} enhancement completed!`, 'success');
            }, 2000);
        };

        // Performance Optimization
        window.updateOptimization = function(type, enabled) {
            if (type === 'auto' && enabled) {
                showToast('üîß Auto-optimization enabled - files will be compressed for faster loading', 'info');
            } else if (type === 'quality' && enabled) {
                showToast('üéØ High quality mode enabled - larger file sizes for maximum visual quality', 'info');
            }
        };

        // Template System
        window.loadTemplate = function(templateName) {
            const templates = {
                'gradient1': {
                    type: 'gradient',
                    background: 'linear-gradient(135deg, #ff6b9d 0%, #8b5cf6 50%, #00d4ff 100%)',
                    name: 'Sunset Paradise'
                },
                'gradient2': {
                    type: 'gradient',
                    background: 'linear-gradient(135deg, #00d4ff 0%, #0284c7 50%, #1e40af 100%)',
                    name: 'Ocean Depths'
                },
                'gradient3': {
                    type: 'gradient',
                    background: 'linear-gradient(135deg, #10b981 0%, #059669 50%, #065f46 100%)',
                    name: 'Forest Canopy'
                },
                'gradient4': {
                    type: 'gradient',
                    background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #92400e 100%)',
                    name: 'Desert Sunset'
                }
            };
            
            const template = templates[templateName];
            if (template) {
                // Apply template to custom background
                const customBg = document.getElementById('customBackground');
                customBg.style.background = template.background;
                
                switchBackground('custom');
                showToast(`üé≠ ${template.name} template applied!`, 'success');
            }
        };

        window.resetBackground = function() {
            resetFilters();
            showToast('üîÑ Background effects reset to default!', 'success');
        };

        window.applyCustomBackground = function() {
            if (!customBackgroundFile && !document.getElementById('customBackground').style.background) {
                showToast('‚ùå Please select a file or template first!', 'error');
                return;
            }

            const slotName = `Custom ${currentBackgroundSlot === 2 ? '1' : '2'}`;
            
            if (customBackgroundFile) {
                const customBg = document.getElementById('customBackground');
                const videoElement = document.getElementById('customBackgroundVideo');
                const imageElement = document.getElementById('customBackgroundImage');
                
                // Clear previous custom background
                videoElement.style.display = 'none';
                imageElement.style.display = 'none';
                videoElement.src = '';
                imageElement.src = '';
                
                if (customBackgroundType === 'video') {
                    videoElement.src = URL.createObjectURL(customBackgroundFile);
                    videoElement.style.display = 'block';
                    // Apply filters to video element
                    applyFiltersToElement(videoElement);
                } else {
                    imageElement.src = URL.createObjectURL(customBackgroundFile);
                    imageElement.style.display = 'block';
                    // Apply filters to image element
                    applyFiltersToElement(imageElement);
                }
                
                // Update slot data
                backgroundSlots[currentBackgroundSlot] = {
                    type: 'custom',
                    name: slotName,
                    file: customBackgroundFile,
                    filters: { ...currentFilters },
                    active: false
                };
            }
            
            // Switch to custom background
            switchBackground('custom');
            
            // Update slot display
            updateBackgroundSlotDisplay();
            
            // Update button states
            document.querySelectorAll('[data-bg]').forEach(btn => btn.classList.remove('active'));
            document.querySelector('[data-bg="custom"]').classList.add('active');
            
            showToast(`üé® Background applied to ${slotName}!`, 'success');
        };

        function applyFiltersToElement(element) {
            let filterString = '';
            
            if (currentFilters.blur > 0) {
                filterString += `blur(${currentFilters.blur}px) `;
            }
            
            if (currentFilters.brightness !== 100) {
                filterString += `brightness(${currentFilters.brightness}%) `;
            }
            
            if (currentFilters.contrast !== 100) {
                filterString += `contrast(${currentFilters.contrast}%) `;
            }
            
            switch (currentFilters.filter) {
                case 'grayscale':
                    filterString += 'grayscale(100%) ';
                    break;
                case 'sepia':
                    filterString += 'sepia(80%) ';
                    break;
                case 'hue-rotate':
                    filterString += 'hue-rotate(180deg) ';
                    break;
                case 'saturate':
                    filterString += 'saturate(150%) ';
                    break;
            }
            
            element.style.filter = filterString;
            element.style.opacity = currentFilters.opacity / 100;
        }

        window.removeCustomBackground = function() {
            if (confirm('Are you sure you want to remove your custom background from this slot?')) {
                // Reset current slot
                backgroundSlots[currentBackgroundSlot] = {
                    type: 'empty',
                    name: `Custom ${currentBackgroundSlot === 2 ? '1' : '2'}`,
                    active: false
                };
                
                customBackgroundFile = null;
                customBackgroundType = null;
                
                // Clear previews
                document.getElementById('backgroundPreviewContainer').style.display = 'none';
                document.getElementById('backgroundFileInput').value = '';
                
                // Clear custom background elements
                document.getElementById('customBackgroundVideo').style.display = 'none';
                document.getElementById('customBackgroundImage').style.display = 'none';
                document.getElementById('customBackgroundVideo').src = '';
                document.getElementById('customBackgroundImage').src = '';
                
                // Reset upload area
                const uploadArea = document.getElementById('backgroundUploadArea');
                uploadArea.innerHTML = `
                    <div style="font-size: 32px; margin-bottom: 8px;">üé¨</div>
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 5px; color: var(--primary-pink);">Professional Upload Studio</div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">Images, Videos, GIFs ‚Ä¢ AI Enhancement Available</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; margin: 8px 0;">
                        <div class="size-indicator">üì± Mobile: 480x800px</div>
                        <div class="size-indicator">üíª Desktop: 1920x1080px</div>
                        <div class="size-indicator">üì∫ 4K: 3840x2160px</div>
                        <div class="size-indicator">üéÆ Ultra: 2560x1440px</div>
                    </div>
                    <div style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;">Max 100MB ‚Ä¢ Auto-optimization included ‚Ä¢ Drag & Drop supported</div>
                `;
                
                // Update slot display
                updateBackgroundSlotDisplay();
                
                // Switch back to default
                switchBackground('space');
                
                showToast('üóëÔ∏è Custom background removed from slot!', 'success');
            }
        };

        // Modal functions
        window.showProfile = () => ModalManager.show('profile');
        window.showEnhancedProfile = () => ModalManager.show('profile');
        window.showSettings = () => ModalManager.show('settings');
        window.showMyTasks = () => ModalManager.show('myTasks');
        window.showGroups = () => ModalManager.show('groups');
        window.showOnlineUsers = () => ModalManager.show('onlineUsers');
        window.hideModal = (id) => ModalManager.hide(id);

        // Settings functions
        window.updateSetting = function(key, value) {
            appState.updateSettings(key, value);
            showToast(`‚öôÔ∏è ${key} updated!`, 'success');
        };

        window.resetSettings = function() {
            if (confirm('Are you sure you want to reset all settings to defaults?')) {
                appState.settings = {
                    challengeNotifications: true,
                    friendNotifications: true,
                    chatNotifications: false,
                    autoSave: true,
                    difficultyLevel: 'medium',
                    publicProfile: true,
                    showActivity: true,
                    background: 'space'
                };
                ModalManager.loadSettingsModal();
                showToast('‚öôÔ∏è Settings reset to defaults!', 'success');
            }
        };

        window.saveSettings = function() {
            appState.saveState();
            showToast('üíæ Settings saved successfully!', 'success');
            ModalManager.hide('settings');
        };

        // Profile functions
        window.editProfile = function() {
            const newName = prompt('Enter your new name:', appState.user.name);
            if (newName && newName.trim()) {
                appState.updateUser({ name: newName.trim() });
                showToast('‚úèÔ∏è Profile updated!', 'success');
            }
        };

        window.shareProfile = function() {
            const profileText = `Check out my JomBro profile!\n\nLevel: ${appState.user.level}\nTokens: ${appState.user.tokens.toLocaleString()}\nChallenges Completed: ${appState.user.completedChallenges}\n\nJoin me on JomBro!`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'My JomBro Profile',
                    text: profileText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard?.writeText(profileText);
                showToast('üì§ Profile copied to clipboard!', 'success');
            }
        };

        // Task management functions
        window.viewTask = function(taskId) {
            const task = appState.tasks.active.find(t => t.id === taskId);
            if (task) {
                showToast(`üìã Task: ${task.title}\nProgress: ${task.progress}%\nDeadline: ${task.deadline.toLocaleDateString()}`, 'info');
            }
        };

        window.viewCompletedTask = function(taskId) {
            const task = appState.tasks.completed.find(t => t.id === taskId);
            if (task) {
                showToast(`‚úÖ Completed: ${task.title}\nTokens Earned: ${task.tokens}\nCompleted: ${task.completedAt.toLocaleDateString()}`, 'success');
            }
        };

        window.showChallengeSelection = function() {
            ModalManager.hide('myTasks');
            showToast('üéØ Choose a challenge below!', 'success');
        };

        // Group functions
        window.createGroup = function() {
            const groupName = prompt('Enter group name:');
            if (groupName && groupName.trim()) {
                const newGroup = {
                    id: Date.now(),
                    name: groupName.trim(),
                    description: 'New challenge group',
                    members: 1,
                    avatar: 'üè†',
                    isActive: true
                };
                appState.groups.joined.push(newGroup);
                ModalManager.loadGroupsModal();
                showToast(`üè† Group "${groupName}" created!`, 'success');
            }
        };

        window.joinGroup = function(groupId) {
            const group = appState.groups.suggested.find(g => g.id === groupId);
            if (group) {
                group.isActive = true;
                appState.groups.joined.push(group);
                appState.groups.suggested = appState.groups.suggested.filter(g => g.id !== groupId);
                ModalManager.loadGroupsModal();
                showToast(`üè† Joined "${group.name}"!`, 'success');
            }
        };

        window.openGroup = function(groupId) {
            const group = appState.groups.joined.find(g => g.id === groupId);
            if (group) {
                showToast(`üè† Opening "${group.name}" group chat...`, 'info');
                // Here you would typically open a group-specific chat
            }
        };

        window.exploreAllGroups = function() {
            showToast('üîç Group exploration feature coming soon!', 'info');
        };

        // User interaction functions
        window.viewUserProfile = function(userName) {
            showToast(`üë§ Viewing ${userName}'s profile - Coming soon!`, 'info');
        };

        window.sendMessage = function(userName) {
            showToast(`üí¨ Opening chat with ${userName}...`, 'info');
            toggleChat();
        };

        window.inviteFriends = function() {
            const inviteText = `Join me on JomBro - the ultimate social challenge platform!\n\nComplete challenges, earn tokens, and compete with friends!\n\n${window.location.href}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Join me on JomBro!',
                    text: inviteText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard?.writeText(inviteText);
                showToast('üì§ Invite link copied to clipboard!', 'success');
            }
        };

        // Chat system
        window.toggleChat = function() {
            const chatInterface = document.getElementById('chatInterface');
            
            if (chatInterface.classList.contains('open')) {
                chatInterface.classList.remove('open');
                chatInterface.style.transform = 'translateY(100%)';
            } else {
                chatInterface.classList.add('open');
                chatInterface.style.transform = 'translateY(0)';
                initializeChat();
            }
        };

        function initializeChat() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div style="display: flex; justify-content: center; margin: 10px 0;">
                    <div style="background: rgba(255, 255, 255, 0.1); color: var(--text-secondary); font-size: 12px; text-align: center; max-width: 80%; padding: 8px 12px; border-radius: 12px;">
                        Welcome to the challenge group chat! Start discussing your challenges here.
                    </div>
                </div>
            `;
            
            setTimeout(() => addChatMessage('Alex Chen', 'üòé', 'Anyone want to join the coffee shop challenge? ‚òï', false), 1000);
            setTimeout(() => addChatMessage('Maya Patel', 'üåü', 'I\'m in! Which coffee shop should we try? üöÄ', false), 2000);
            setTimeout(() => addChatMessage('Jordan Kim', 'üöÄ', 'There\'s a great one downtown with amazing poetry vibes!', false), 3000);
        }

        function addChatMessage(sender, avatar, text, isOwn) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.innerHTML = `
                <div style="display: flex; ${isOwn ? 'flex-direction: row-reverse;' : ''} gap: 10px; margin-bottom: 10px;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: ${isOwn ? 'var(--primary-pink)' : 'linear-gradient(45deg, var(--primary-blue), var(--primary-purple))'}; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0;">${avatar}</div>
                    <div style="background: ${isOwn ? 'var(--primary-pink)' : 'rgba(255,255,255,0.1)'}; padding: 8px 12px; border-radius: 12px; max-width: 70%; word-wrap: break-word;">
                        <div style="font-size: 14px; line-height: 1.4;">${text}</div>
                        <div style="font-size: 11px; color: ${isOwn ? 'rgba(255,255,255,0.8)' : 'var(--text-secondary)'}; margin-top: 4px;">now</div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        window.sendMessage = function() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            addChatMessage('You', appState.user.avatar, text, true);
            input.value = '';
            
            setTimeout(() => {
                const responses = [
                    { sender: 'Maya Patel', avatar: 'üåü', text: 'That sounds awesome! üéâ' },
                    { sender: 'Alex Chen', avatar: 'üòé', text: 'Count me in! When do we start?' },
                    { sender: 'Jordan Kim', avatar: 'üöÄ', text: 'Great idea! Let\'s do this together!' }
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                addChatMessage(response.sender, response.avatar, response.text, false);
            }, 1500);
        };

        window.handleChatKeyPress = function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        };

        // ===== CHALLENGE SYSTEM (Enhanced from original) =====
        
        const MASTER_CHALLENGE_DATABASE = {
            SOCIAL: {
                name: 'Social Connection',
                icon: 'üë•',
                color: '#ff6b9d',
                challenges: [
                    {
                        id: 'social_001',
                        title: 'Coffee Shop Poetry Challenge',
                        description: 'Visit any coffee shop and ask the barista to write a short poem on your cup or napkin! Share your experience with friends and see who gets the most creative poem!',
                        difficulty: 'Easy',
                        duration: '30m',
                        tokens: 500,
                        hashtags: ['#CoffeePoetry', '#Connection', '#JomBro']
                    },
                    {
                        id: 'social_002',
                        title: 'Random Compliment Challenge',
                        description: 'Give genuine compliments to 5 strangers today. Watch how their faces light up and document the positive reactions!',
                        difficulty: 'Easy',
                        duration: '1h',
                        tokens: 400,
                        hashtags: ['#Kindness', '#Social', '#GoodVibes']
                    },
                    {
                        id: 'social_003',
                        title: 'Language Exchange Adventure',
                        description: 'Find someone who speaks a different language and teach each other 10 words. Record a video of your mini language lesson!',
                        difficulty: 'Medium',
                        duration: '45m',
                        tokens: 650,
                        hashtags: ['#Language', '#Cultural', '#Learning']
                    }
                ]
            },
            FITNESS: {
                name: 'Fitness & Health',
                icon: 'üí™',
                color: '#10b981',
                challenges: [
                    {
                        id: 'fitness_001',
                        title: 'Sunrise Workout Challenge',
                        description: 'Wake up early and do a 20-minute workout outside during sunrise. Capture the golden hour and inspire others with your dedication!',
                        difficulty: 'Medium',
                        duration: '45m',
                        tokens: 600,
                        hashtags: ['#SunriseWorkout', '#Fitness', '#EarlyBird']
                    },
                    {
                        id: 'fitness_002',
                        title: 'Stair Climbing Marathon',
                        description: 'For one full day, take stairs instead of elevators/escalators. Count total floors climbed and celebrate your achievement!',
                        difficulty: 'Easy',
                        duration: '1 day',
                        tokens: 400,
                        hashtags: ['#Stairs', '#Fitness', '#HealthyChoices']
                    }
                ]
            },
            CREATIVE: {
                name: 'Creative Expression',
                icon: 'üé®',
                color: '#8b5cf6',
                challenges: [
                    {
                        id: 'creative_001',
                        title: 'One-Minute Story Challenge',
                        description: 'Record yourself telling a complete story in exactly 60 seconds. It can be real or fictional - just make it engaging and memorable!',
                        difficulty: 'Medium',
                        duration: '30m',
                        tokens: 550,
                        hashtags: ['#Storytelling', '#Creative', '#VideoChallenge']
                    },
                    {
                        id: 'creative_002',
                        title: 'Food Art Masterpiece',
                        description: 'Create art using only food items. Make a face with your breakfast, build a landscape with vegetables, or design edible sculptures!',
                        difficulty: 'Easy',
                        duration: '20m',
                        tokens: 350,
                        hashtags: ['#FoodArt', '#Creative', '#Breakfast']
                    }
                ]
            },
            ADVENTURE: {
                name: 'Adventure & Exploration',
                icon: 'üó∫Ô∏è',
                color: '#f59e0b',
                challenges: [
                    {
                        id: 'adventure_001',
                        title: 'Mystery Location Challenge',
                        description: 'Close your eyes, point to a spot on a map within 10km, and visit that exact location. Discover something new about your area!',
                        difficulty: 'Hard',
                        duration: '3h',
                        tokens: 900,
                        hashtags: ['#Adventure', '#Exploration', '#Mystery']
                    }
                ]
            },
            MINDFULNESS: {
                name: 'Mindfulness & Growth',
                icon: 'üß†',
                color: '#06b6d4',
                challenges: [
                    {
                        id: 'mindful_001',
                        title: 'Digital Detox Hour',
                        description: 'Spend 1 hour completely disconnected from all digital devices. Document what you discovered about yourself during this time!',
                        difficulty: 'Hard',
                        duration: '1h',
                        tokens: 600,
                        hashtags: ['#DigitalDetox', '#Mindfulness', '#SelfCare']
                    }
                ]
            }
        };

        let currentChallengeSet = [];
        let usedChallengeIds = new Set();

        function getAllChallenges() {
            const allChallenges = [];
            Object.keys(MASTER_CHALLENGE_DATABASE).forEach(categoryKey => {
                const category = MASTER_CHALLENGE_DATABASE[categoryKey];
                category.challenges.forEach(challenge => {
                    allChallenges.push({
                        ...challenge,
                        category: categoryKey,
                        categoryInfo: category
                    });
                });
            });
            return allChallenges;
        }

        async function generateSmartChallengeSet(count = 8) {
            const allChallenges = getAllChallenges();
            const shuffled = allChallenges.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function initializeChallenges() {
            generateAndDisplayChallenges();
        }

        async function generateAndDisplayChallenges() {
            currentChallengeSet = await generateSmartChallengeSet(8);
            displayChallengeSelection();
        }

        function displayChallengeSelection() {
            const container = document.getElementById('challengeSelection');
            container.innerHTML = '';

            currentChallengeSet.forEach((challenge, index) => {
                const challengeCard = document.createElement('div');
                challengeCard.className = 'challenge-card';
                
                challengeCard.innerHTML = `
                    <div class="challenge-category-badge" style="background: ${challenge.categoryInfo.color}">
                        ${challenge.categoryInfo.icon} ${challenge.categoryInfo.name}
                    </div>
                    <div style="margin-top: 30px;">
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px; color: var(--primary-pink);">
                            ${challenge.title}
                        </div>
                        <div style="font-size: 13px; line-height: 1.4; margin-bottom: 15px; opacity: 0.9; color: var(--text-secondary);">
                            ${challenge.description}
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px;">
                            <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px; backdrop-filter: blur(15px);">
                                <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${challenge.tokens}</div>
                                <div style="font-size: 9px; color: var(--text-secondary);">TOKENS</div>
                            </div>
                            <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px; backdrop-filter: blur(15px);">
                                <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${challenge.difficulty}</div>
                                <div style="font-size: 9px; color: var(--text-secondary);">LEVEL</div>
                            </div>
                            <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px; backdrop-filter: blur(15px);">
                                <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${challenge.duration}</div>
                                <div style="font-size: 9px; color: var(--text-secondary);">TIME</div>
                            </div>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 15px;">
                            ${challenge.hashtags.map(tag => `<span style="font-size: 9px; padding: 2px 6px; background: rgba(255, 107, 157, 0.1); color: var(--primary-pink); border-radius: 6px;">${tag}</span>`).join('')}
                        </div>
                        <button class="btn-primary" onclick="takeChallenge(${index})" style="width: 100%; padding: 12px; font-size: 13px;">
                            üöÄ TAKE CHALLENGE
                        </button>
                    </div>
                `;

                container.appendChild(challengeCard);
            });
        }

        window.takeChallenge = function(index) {
            const challenge = currentChallengeSet[index];
            if (!challenge) {
                showToast('‚ö†Ô∏è Challenge not found!', 'error');
                return;
            }

            if (confirm(`üéØ Ready to take on "${challenge.title}"?\n\nThis challenge will reward you with ${challenge.tokens} tokens!\n\nClick OK to accept!`)) {
                // Add to active tasks
                const newTask = {
                    id: Date.now(),
                    title: challenge.title,
                    description: challenge.description,
                    deadline: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours from now
                    progress: 0,
                    category: challenge.categoryInfo.name,
                    status: 'in-progress',
                    tokens: challenge.tokens
                };
                
                appState.tasks.active.push(newTask);
                appState.saveState();
                
                // Update notification badge
                const badge = document.getElementById('tasksNotifications');
                badge.style.display = 'block';
                badge.textContent = appState.tasks.active.length;
                
                showToast(`üéØ Challenge "${challenge.title}" accepted!`, 'success');
                
                // Show current challenge status
                document.getElementById('currentChallengeStatus').style.display = 'block';
                document.getElementById('currentChallengeTitle').textContent = challenge.title;
                
                // Update main action button
                document.getElementById('mainActionBtn').textContent = 'üì∏ SUBMIT PROOF';
                document.getElementById('mainActionBtn').onclick = function() {
                    openProofSubmission(challenge);
                };
            }
        };

        window.refreshChallenges = async function() {
            const refreshBtn = document.querySelector('[onclick="refreshChallenges()"]');
            refreshBtn.style.opacity = '0.5';
            refreshBtn.style.pointerEvents = 'none';
            
            try {
                await generateAndDisplayChallenges();
                showToast('‚ú® New challenges generated!', 'success');
            } catch (error) {
                showToast('‚ö†Ô∏è Challenge refresh failed', 'error');
            } finally {
                refreshBtn.style.opacity = '1';
                refreshBtn.style.pointerEvents = 'auto';
            }
        };

        // ===== PROOF SUBMISSION SYSTEM =====
        
        let currentProofFile = null;
        let currentChallengeForProof = null;

        window.openProofSubmission = function(challengeData = null) {
            currentChallengeForProof = challengeData || {
                title: "Coffee Shop Poetry Challenge",
                description: "Visit a coffee shop and ask for a poem on your cup"
            };
            
            document.getElementById('proofChallengeTitle').textContent = currentChallengeForProof.title;
            ModalManager.show('proofSubmission');
        };

        window.showProofGallery = function() {
            ModalManager.show('proofGallery');
            loadProofGallery();
        };

        window.handleProofUpload = function(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file size (50MB max)
            if (file.size > 50 * 1024 * 1024) {
                showToast('‚ùå File too large! Maximum 50MB allowed.', 'error');
                return;
            }

            // Validate file type
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'video/mp4', 'video/mov', 'video/avi'];
            if (!allowedTypes.includes(file.type)) {
                showToast('‚ùå Invalid file type! Only images and videos allowed.', 'error');
                return;
            }

            currentProofFile = file;
            const isVideo = file.type.startsWith('video/');
            
            // Show preview
            const previewContainer = document.getElementById('proofPreviewContainer');
            const imagePreview = document.getElementById('proofPreview');
            const videoPreview = document.getElementById('proofVideoPreview');
            
            previewContainer.style.display = 'block';
            
            if (isVideo) {
                imagePreview.style.display = 'none';
                videoPreview.style.display = 'block';
                videoPreview.src = URL.createObjectURL(file);
            } else {
                videoPreview.style.display = 'none';
                imagePreview.style.display = 'block';
                imagePreview.src = URL.createObjectURL(file);
            }

            // Update upload area
            const uploadArea = document.getElementById('proofUploadArea');
            uploadArea.innerHTML = `
                <div style="font-size: 24px; margin-bottom: 10px;">‚úÖ</div>
                <div style="font-size: 14px; font-weight: 600; margin-bottom: 5px; color: var(--success-green);">File Ready!</div>
                <div style="font-size: 12px; color: var(--text-secondary);">${file.name}</div>
                <div style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;">Click to change file</div>
            `;

            showToast(`üì∏ ${isVideo ? 'Video' : 'Image'} uploaded successfully!`, 'success');
        };

        window.submitProof = function() {
            if (!currentProofFile) {
                showToast('‚ùå Please upload a proof file first!', 'error');
                return;
            }

            const description = document.getElementById('proofDescription').value.trim();
            if (!description) {
                showToast('‚ùå Please describe your experience!', 'error');
                return;
            }

            // Show progress
            const progressContainer = document.getElementById('proofProgress');
            const progressBar = document.getElementById('proofProgressBar');
            const submitBtn = document.getElementById('submitProofBtn');
            
            progressContainer.style.display = 'block';
            submitBtn.disabled = true;
            submitBtn.textContent = 'Uploading...';

            // Simulate upload progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Simulate processing time
                    setTimeout(() => {
                        processProofSubmission(description);
                    }, 1000);
                }
            }, 200);
        };

        function processProofSubmission(description) {
            // Complete the task
            const activeTaskIndex = appState.tasks.active.findIndex(task => 
                task.title === currentChallengeForProof.title
            );
            
            if (activeTaskIndex !== -1) {
                const completedTask = appState.tasks.active[activeTaskIndex];
                completedTask.completedAt = new Date();
                completedTask.tokens = currentChallengeForProof.tokens || 500;
                
                // Move to completed tasks
                appState.tasks.completed.unshift(completedTask);
                appState.tasks.active.splice(activeTaskIndex, 1);
                
                // Update user stats
                const tokensEarned = completedTask.tokens;
                appState.updateUser({
                    tokens: appState.user.tokens + tokensEarned,
                    completedChallenges: appState.user.completedChallenges + 1,
                    xp: appState.user.xp + Math.floor(tokensEarned / 10)
                });
                
                // Check for level up
                const newLevel = Math.floor(appState.user.xp / 1000) + 1;
                if (newLevel > appState.user.level) {
                    appState.updateUser({ level: newLevel });
                    showToast(`üéâ LEVEL UP! You're now level ${newLevel}!`, 'success');
                }
                
                // Update notification badges
                const badge = document.getElementById('tasksNotifications');
                if (appState.tasks.active.length > 0) {
                    badge.textContent = appState.tasks.active.length;
                } else {
                    badge.style.display = 'none';
                }
            }
            
            // Hide proof modal
            ModalManager.hide('proofSubmission');
            resetProofModal();
            
            // Hide current challenge status
            document.getElementById('currentChallengeStatus').style.display = 'none';
            
            // Reset main action button
            document.getElementById('mainActionBtn').textContent = 'üéØ START CHALLENGE';
            document.getElementById('mainActionBtn').onclick = function() {
                showChallengeAgreement();
            };
            
            showToast('üèÜ Challenge completed successfully! Tokens earned!', 'success');
            
            // Create celebration effect
            createCelebrationEffect();
        }

        function resetProofModal() {
            currentProofFile = null;
            document.getElementById('proofFileInput').value = '';
            document.getElementById('proofDescription').value = '';
            document.getElementById('proofPreviewContainer').style.display = 'none';
            document.getElementById('proofProgress').style.display = 'none';
            document.getElementById('submitProofBtn').disabled = false;
            document.getElementById('submitProofBtn').textContent = 'üöÄ Submit Proof';
            
            // Reset upload area
            document.getElementById('proofUploadArea').innerHTML = `
                <div style="font-size: 48px; margin-bottom: 10px;">üì∏</div>
                <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px; color: var(--primary-pink);">Click to Upload Proof</div>
                <div style="font-size: 12px; color: var(--text-secondary);">Photos, Videos, or Screenshots accepted</div>
                <div style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;">Max 50MB ‚Ä¢ JPG, PNG, MP4, MOV</div>
            `;
        }

        function loadProofGallery() {
            const container = document.getElementById('fullGalleryContainer');
            
            // Sample proof gallery data
            const proofGallery = [
                {
                    id: 1,
                    user: appState.user.name,
                    avatar: appState.user.avatar,
                    challenge: 'Coffee Shop Poetry',
                    title: 'Challenge Genius',
                    timestamp: new Date(Date.now() - 60000 * 30)
                },
                {
                    id: 2,
                    user: 'Alex Chen',
                    avatar: 'üòé',
                    challenge: 'Sunrise Workout',
                    title: 'Ultimate Winner',
                    timestamp: new Date(Date.now() - 60000 * 120)
                },
                {
                    id: 3,
                    user: 'Maya Patel',
                    avatar: 'üåü',
                    challenge: 'Street Art Hunt',
                    title: 'Super Achiever',
                    timestamp: new Date(Date.now() - 60000 * 180)
                },
                {
                    id: 4,
                    user: 'Jordan Kim',
                    avatar: 'üöÄ',
                    challenge: 'Food Art',
                    title: 'Creative Innovator',
                    timestamp: new Date(Date.now() - 60000 * 240)
                }
            ];
            
            container.innerHTML = proofGallery.map(proof => {
                const timeAgo = ModalManager.getTimeAgo(proof.timestamp);
                
                return `
                    <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 10px; text-align: center; cursor: pointer; transition: all 0.3s ease;" onclick="viewProofDetails(${proof.id})">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(45deg, var(--primary-pink), var(--primary-purple)); display: flex; align-items: center; justify-content: center; font-size: 18px; margin: 0 auto 8px; animation: pulse 2s ease-in-out infinite;">
                            ${proof.avatar}
                        </div>
                        <div style="font-size: 10px; font-weight: 600; margin-bottom: 3px;">${proof.user}</div>
                        <div style="font-size: 8px; color: var(--text-secondary); margin-bottom: 3px;">${proof.challenge}</div>
                        <div style="font-size: 7px; color: var(--success-green); background: rgba(16, 185, 129, 0.1); padding: 2px 4px; border-radius: 4px;">${timeAgo}</div>
                        <div style="position: absolute; top: 5px; right: 5px; width: 12px; height: 12px; border-radius: 50%; background: var(--gold); display: flex; align-items: center; justify-content: center; font-size: 8px;">üèÜ</div>
                    </div>
                `;
            }).join('');
        }

        window.viewProofDetails = function(proofId) {
            showToast(`üèÜ Viewing proof details for submission #${proofId}`, 'info');
        };

        function createCelebrationEffect() {
            // Create floating emojis
            const emojis = ['üéâ', 'üèÜ', '‚≠ê', 'üéä', 'üî•', 'üí´'];
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.cssText = `
                        position: fixed;
                        font-size: 24px;
                        left: ${Math.random() * window.innerWidth}px;
                        top: ${window.innerHeight}px;
                        pointer-events: none;
                        z-index: 9999;
                        animation: float-up 3s ease-out forwards;
                    `;
                    
                    document.body.appendChild(emoji);
                    
                    setTimeout(() => {
                        if (emoji.parentNode) {
                            emoji.parentNode.removeChild(emoji);
                        }
                    }, 3000);
                }, i * 200);
            }
        }

        // Add CSS for floating animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float-up {
                0% {
                    transform: translateY(0) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(-${window.innerHeight}px) rotate(360deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // ===== ONLINE USERS SYSTEM =====
        
        function initializeOnlineUsers() {
            updateOnlineCount();
            updateLivePlayersDisplay();
            
            // Simulate real-time updates
            setInterval(() => {
                simulateUserActivity();
            }, 10000); // Update every 10 seconds
        }

        function updateOnlineCount() {
            const onlineCount = appState.onlineUsers.length;
            document.getElementById('onlineCount').textContent = `${onlineCount} online`;
            
            // Update overlay badge
            const overlayBadge = document.getElementById('overlayOnlineNotifications');
            if (overlayBadge) overlayBadge.textContent = onlineCount;
        }

        function updateLivePlayersDisplay() {
            const container = document.getElementById('livePlayersContainer');
            const onlineNow = appState.onlineUsers.slice(0, 8);
            
            container.innerHTML = onlineNow.map(user => `
                <div style="position: relative; flex-shrink: 0;">
                    <div style="width: 44px; height: 44px; border-radius: 22px; background: linear-gradient(45deg, var(--primary-pink), var(--primary-purple)); padding: 2px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 0 20px rgba(255, 107, 157, 0.3);" onclick="viewUserProfile('${user.name}')" title="${user.name} - ${user.activity}">
                        <div style="width: 100%; height: 100%; border-radius: 50%; background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; font-size: 16px; overflow: hidden;">
                            <span style="font-size: 18px;">${user.avatar}</span>
                        </div>
                    </div>
                    <div style="position: absolute; bottom: 0; right: 0; width: 10px; height: 10px; background: var(--success-green); border: 2px solid rgba(10, 10, 10, 0.8); border-radius: 50%; animation: pulse 2s infinite; box-shadow: 0 0 8px var(--success-green);"></div>
                    <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); background: var(--primary-purple); color: white; font-size: 8px; font-weight: 700; padding: 2px 6px; border-radius: 8px; border: 1px solid rgba(0, 0, 0, 0.3); box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4); min-width: 20px; text-align: center;">L${user.level}</div>
                </div>
            `).join('');
        }

        function simulateUserActivity() {
            // Randomly update user activities
            appState.onlineUsers.forEach(user => {
                if (Math.random() < 0.3) { // 30% chance to update activity
                    const activities = [
                        'Taking photos', 'In coffee shop', 'Working out', 'Reading book',
                        'Cooking meal', 'Walking in park', 'Meeting friends', 'Learning new skill'
                    ];
                    user.activity = activities[Math.floor(Math.random() * activities.length)];
                }
            });
            
            updateLivePlayersDisplay();
        }

        // ===== AUTHENTICATION SYSTEM =====
        
        window.signInWithGoogle = function() {
            showToast('üîç Connecting with Google...', 'info');
            setTimeout(() => {
                appState.updateUser({
                    name: 'Google User',
                    email: 'user@gmail.com'
                });
                completeAuthentication();
            }, 1500);
        };

        window.signInWithFacebook = function() {
            showToast('üìò Connecting with Facebook...', 'info');
            setTimeout(() => {
                appState.updateUser({
                    name: 'Facebook User',
                    email: 'user@facebook.com'
                });
                completeAuthentication();
            }, 1500);
        };

        window.signInAnonymously = function() {
            showToast('üß™ Entering test mode...', 'info');
            setTimeout(() => {
                appState.updateUser({
                    name: 'Test User',
                    email: 'test@jombro.com'
                });
                completeAuthentication();
            }, 1000);
        };

        window.showPhoneForm = function() {
            document.getElementById('mainAuth').style.display = 'none';
            document.getElementById('phoneForm').style.display = 'block';
        };

        window.showMainAuth = function() {
            document.getElementById('phoneForm').style.display = 'none';
            document.getElementById('mainAuth').style.display = 'block';
        };

        window.signInWithPhone = function() {
            const phoneInput = document.getElementById('phoneInput');
            const phone = phoneInput.value.trim();
            
            if (!phone) {
                showToast('‚ùå Please enter your phone number!', 'error');
                return;
            }
            
            showToast('üì± Sending verification code...', 'info');
            setTimeout(() => {
                appState.updateUser({
                    name: 'Phone User',
                    email: phone
                });
                completeAuthentication();
            }, 2000);
        };

        function completeAuthentication() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('rightOverlay').style.display = 'flex';
            
            showToast('‚úÖ Welcome to JomBro!', 'success');
            initializeApp();
        }

        window.signOut = function() {
            if (confirm('Are you sure you want to sign out?')) {
                document.getElementById('authScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('rightOverlay').style.display = 'none';
                
                // Close any open modals
                ModalManager.openModals.forEach(modalId => {
                    ModalManager.hide(modalId);
                });
                
                // Close chat if open
                const chatInterface = document.getElementById('chatInterface');
                chatInterface.classList.remove('open');
                chatInterface.style.transform = 'translateY(100%)';
                
                showToast('üëã Signed out successfully!', 'success');
            }
        };

        // ===== UTILITY FUNCTIONS =====
        
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.textContent = message;
            
            Object.assign(toast.style, {
                position: 'fixed',
                top: '20px',
                left: '50%',
                transform: 'translateX(-50%)',
                background: type === 'success' ? 'var(--success-green)' : 
                           type === 'error' ? 'var(--error-red)' : 'var(--primary-pink)',
                color: 'white',
                padding: '12px 20px',
                borderRadius: '10px',
                zIndex: '4000',
                fontSize: '14px',
                fontWeight: '600',
                opacity: '0',
                transition: 'all 0.3s ease',
                maxWidth: '90%',
                textAlign: 'center',
                backdropFilter: 'blur(20px)',
                border: '1px solid rgba(255, 255, 255, 0.1)',
                boxShadow: '0 8px 32px rgba(0, 0, 0, 0.3)'
            });
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(-50%) translateY(10px)';
            }, 100);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // ===== PLACEHOLDER FUNCTIONS =====
        
        window.showChallengeAgreement = function() {
            showToast('üéØ Ready to challenge! Choose any challenge above!', 'success');
        };

        window.viewChallenge = function() {
            showToast('üëÄ Challenge details coming soon!', 'info');
        };

        window.showFailureHall = function() {
            showToast('üö® Hall of Shame feature coming soon!', 'info');
        };

        // ===== APP INITIALIZATION =====
        
        function initializeApp() {
            initializeChallenges();
            initializeOnlineUsers();
            appState.updateUserDisplay();
            
            // Initialize notification badges
            document.getElementById('overlayGalleryNotifications').textContent = '12';
            document.getElementById('overlayFailureNotifications').textContent = '3';
            document.getElementById('overlayOnlineNotifications').textContent = appState.onlineUsers.length;
            
            console.log('üöÄ JomBro Enhanced Full-Featured Platform Loaded!');
            console.log('‚ú® All features activated and organized!');
            console.log('üåå ENHANCED Cosmic Night Sky: Ultra-dense stars, nebula clouds, aurora effects');
            console.log('üåü 12 Shooting Stars: Enhanced meteor shower with gradient trails');
            console.log('‚≠ê Multi-layered Star System: Supernova, major, medium, micro stars');
            console.log('üéÜ Constellation Patterns: Big Dipper and custom star formations');
            console.log('üåà Aurora Effects: Northern lights with dynamic wave animation');
            console.log('üé¨ Professional Background Studio: 3 slots, AI enhancement, filters');
            console.log('üõ†Ô∏è Advanced Tools: Blur, opacity, brightness, contrast controls');
            console.log('üé® Smart Filters: B&W, vintage, colorshift, vibrant presets');
            console.log('ü§ñ AI Enhancement: Upscale, denoise, colorize, stylize (BETA)');
            console.log('üìä Quality Analysis: Auto size detection, aspect ratio validation');
            console.log('üé≠ Quick Templates: Sunset, ocean, forest, desert gradients');
            console.log('‚ö° Performance Options: Auto-optimization, high quality mode');
            console.log('üì± Responsive Preview: Mobile/desktop preview modes');
            console.log('üìÇ Multi-slot System: 3 background slots with smart management');
            console.log('‚úÖ Professional Upload: 100MB max, 4K support, drag & drop');
            console.log('üì± Complete modal system with real functionality');
            console.log('üéØ Smart challenge management');
            console.log('üë• Live user interaction system');
            console.log('‚öôÔ∏è Comprehensive settings management');
            console.log('üìã Task tracking and progress monitoring');
            console.log('üè† Group management and discovery');
            console.log('üí¨ Enhanced chat system');
            console.log('üèÜ Proof submission and gallery');
            console.log('üåü Celebration effects and animations');
        }

        // ===== EVENT LISTENERS =====
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ JomBro Enhanced Challenge Platform Initializing...');
            
            // Initialize with enhanced cosmic night sky background
            switchBackground('space');
            
            // Set up drag and drop for proof upload
            const uploadArea = document.getElementById('proofUploadArea');
            if (uploadArea) {
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = 'var(--primary-pink)';
                    uploadArea.style.background = 'rgba(255, 107, 157, 0.15)';
                });
                
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.style.borderColor = 'rgba(255, 107, 157, 0.3)';
                    uploadArea.style.background = 'rgba(255, 107, 157, 0.05)';
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = 'rgba(255, 107, 157, 0.3)';
                    uploadArea.style.background = 'rgba(255, 107, 157, 0.05)';
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const event = { target: { files: [files[0]] } };
                        handleProofUpload(event);
                    }
                });
            }
            
            // Set up drag and drop for background upload
            const backgroundUploadArea = document.getElementById('backgroundUploadArea');
            if (backgroundUploadArea) {
                backgroundUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    backgroundUploadArea.classList.add('dragover');
                });
                
                backgroundUploadArea.addEventListener('dragleave', () => {
                    backgroundUploadArea.classList.remove('dragover');
                });
                
                backgroundUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    backgroundUploadArea.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const event = { target: { files: [files[0]] } };
                        handleBackgroundUpload(event);
                    }
                });
            }
            
            // Close modals when clicking outside
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    const modalId = e.target.id.replace('Modal', '');
                    ModalManager.hide(modalId);
                }
            });
            
            // Handle escape key for modals
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && ModalManager.openModals.size > 0) {
                    const lastModal = Array.from(ModalManager.openModals).pop();
                    ModalManager.hide(lastModal);
                }
            });
            
            console.log('‚úÖ JomBro Enhanced Platform Ready!');
            console.log('üåå Enhanced Cosmic Night Sky: Multi-layered stars with aurora effects');
            console.log('üîç FLOATING GLASS INTERFACE: All UI elements float 3mm above background');
            console.log('‚ú® Depth Perception: Clear separation between night sky and interface');
            console.log('üé® Enhanced Transparency: Night sky clearly visible through glass elements');
            console.log('üíé Premium Glass Effects: Backdrop blur, saturation, gradient overlays');
            console.log('üåü Layered Shadows: 3D depth with multiple shadow layers');
            console.log('üì± Floating Components: Header, sections, modals, overlays all elevated');
            console.log('üé¨ Professional Background Studio: 3-slot system with AI tools');
            console.log('üõ†Ô∏è Advanced Editing: Filters, effects, performance optimization');
            console.log('üì± Smart Upload: 4K support, quality analysis, drag & drop');
            console.log('ü§ñ AI Enhancement: Upscale, denoise, colorize, stylize features');
            console.log('üé≠ Quick Templates: Professional gradient backgrounds included');
            console.log('‚ö° Performance Modes: Auto-optimization vs High Quality options');
            console.log('üìä Quality Ratings: Auto-analysis with size recommendations');
        });

    </script>
</body>
</html>
