<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ff6b9d">
    
    <title>JomBro - Challenge Platform</title>

    <style>
        /* ===== STABLE MOBILE-FIRST DESIGN ===== */
        
        :root {
            --safe-area-top: env(safe-area-inset-top, 20px);
            --safe-area-bottom: env(safe-area-inset-bottom, 20px);
            
            --primary-color: #ff6b9d;
            --primary-dark: #e55a87;
            --secondary-color: #667eea;
            --accent-color: #4facfe;
            
            --dark-bg: #0a0a0a;
            --glass-bg: rgba(20, 20, 30, 0.6);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --error-red: #ef4444;
            
            --touch-target: 44px;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-primary);
            user-select: none;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Simple animated background */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 1;
        }

        /* Floating particles */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }

        /* Main container */
        .app-container {
            position: relative;
            z-index: 2;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Glass card system */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin: 10px 0;
        }

        /* Header */
        .header {
            padding: calc(var(--safe-area-top) + 16px) 20px 16px 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .logo {
            font-size: 24px;
            font-weight: 300;
            color: var(--text-primary);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .user-info {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: right;
        }

        /* Main content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 0 20px 100px 20px;
            -webkit-overflow-scrolling: touch;
        }

        /* Stats cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 16px;
            text-align: center;
            transition: transform 0.2s ease;
            cursor: pointer;
        }

        .stat-card:active {
            transform: scale(0.95);
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* Challenge cards */
        .challenge-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin: 20px 0;
        }

        .challenge-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .challenge-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 0.1);
        }

        .challenge-card:active {
            transform: translateY(0) scale(0.98);
        }

        .challenge-icon {
            font-size: 32px;
            text-align: center;
            margin-bottom: 12px;
        }

        .challenge-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .challenge-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .challenge-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }

        .challenge-difficulty {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
            color: var(--text-secondary);
        }

        .challenge-tokens {
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
        }

        /* Buttons */
        .btn {
            border: none;
            border-radius: var(--border-radius);
            padding: 16px 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            min-height: var(--touch-target);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(255, 107, 157, 0.6);
        }

        .btn-primary:active {
            transform: translateY(0) scale(0.98);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-secondary:active {
            transform: scale(0.95);
        }

        /* Bottom navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
            padding: 12px 0 calc(var(--safe-area-bottom) + 12px) 0;
            display: flex;
            justify-content: space-around;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: var(--touch-target);
            position: relative;
        }

        .nav-item:active {
            transform: scale(0.9);
        }

        .nav-item.active {
            background: rgba(255, 107, 157, 0.2);
            color: var(--primary-color);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 600;
        }

        .badge {
            position: absolute;
            top: 2px;
            right: 8px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Modal system */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 2000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            padding: 20px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        /* Auth screen */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--dark-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px;
        }

        .auth-container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: var(--shadow);
            max-width: 350px;
            width: 100%;
        }

        .auth-title {
            font-size: 28px;
            font-weight: 300;
            margin-bottom: 8px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .auth-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 16px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 16px;
        }

        .auth-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .auth-btn:active {
            transform: translateY(0) scale(0.98);
        }

        /* Form inputs */
        .form-input {
            width: 100%;
            padding: 16px;
            margin: 12px 0;
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            background: var(--glass-bg);
            color: var(--text-primary);
            font-size: 16px;
            backdrop-filter: blur(10px);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.3);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: calc(var(--safe-area-top) + 60px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            z-index: 4000;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: calc(100% - 40px);
            text-align: center;
        }

        .toast.show {
            opacity: 1;
        }

        .toast.success { background: var(--success-green); }
        .toast.warning { background: var(--warning-orange); }
        .toast.error { background: var(--error-red); }

        /* Loading state */
        .loading {
            opacity: 0.7;
            pointer-events: none;
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid transparent;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Progress bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Responsive design */
        @media (max-width: 480px) {
            .header {
                padding: calc(var(--safe-area-top) + 12px) 16px 12px 16px;
            }
            
            .main-content {
                padding: 0 16px 100px 16px;
            }
            
            .glass-card {
                padding: 16px;
            }
            
            .auth-container {
                margin: 16px;
                padding: 32px 24px;
            }
        }

        /* Utility classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        @media (prefers-contrast: high) {
            :root {
                --glass-bg: rgba(0, 0, 0, 0.9);
                --glass-border: rgba(255, 255, 255, 0.5);
            }
        }
    </style>
</head>
<body>
    <!-- Background -->
    <div class="background">
        <div class="particle" style="top: 10%; left: 10%; animation-delay: 0s;"></div>
        <div class="particle" style="top: 20%; left: 80%; animation-delay: 1s;"></div>
        <div class="particle" style="top: 80%; left: 20%; animation-delay: 2s;"></div>
        <div class="particle" style="top: 60%; left: 90%; animation-delay: 3s;"></div>
    </div>

    <!-- Auth Screen -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <div style="font-size: 48px; margin-bottom: 16px;">🚀</div>
            <div class="auth-title">Welcome to JomBro</div>
            <div class="auth-subtitle">Connect with friends and tackle challenges together!</div>
            
            <div id="errorMessage" class="toast error" style="position: relative; margin-bottom: 16px; display: none;"></div>
            
            <div id="mainAuth">
                <button class="auth-btn" onclick="signInWithGoogle()">
                    🔍 Continue with Google
                </button>
                <button class="auth-btn" onclick="signInWithFacebook()">
                    📘 Continue with Facebook
                </button>
                <button class="auth-btn" onclick="showPhoneForm()">
                    📱 Continue with Phone
                </button>
                <button class="auth-btn" onclick="signInAnonymously()">
                    🧪 Test Mode (Skip Login)
                </button>
            </div>

            <div id="phoneForm" class="hidden">
                <input type="tel" id="phoneInput" class="form-input" placeholder="+60123456789">
                <input type="text" id="otpInput" class="form-input hidden" placeholder="Enter verification code">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px;">
                    <button class="btn btn-secondary" onclick="showMainAuth()">Back</button>
                    <button class="btn btn-primary" id="phoneSubmitBtn" onclick="signInWithPhone()">Send Code</button>
                </div>
            </div>
            
            <div style="margin-top: 24px; font-size: 12px; color: var(--text-secondary);">
                By continuing, you agree to our Terms & Privacy Policy
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="app-container hidden">
        <!-- Header -->
        <div class="header">
            <div class="logo">JomBro</div>
            <div class="user-info">
                <div id="userDisplayName">Demo User</div>
                <div style="font-size: 10px; color: var(--primary-color);" id="userStatus">Level 5</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- User Stats -->
            <div class="stats-grid">
                <div class="stat-card" onclick="showToast('Level details coming soon!', 'info')">
                    <div class="stat-value" id="userLevelDisplay">5</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="stat-card" onclick="showToast('Token details coming soon!', 'info')">
                    <div class="stat-value" id="userTokensDisplay">2,450</div>
                    <div class="stat-label">Tokens</div>
                </div>
                <div class="stat-card" onclick="showToast('Achievements coming soon!', 'info')">
                    <div class="stat-value" id="userChallengesDisplay">12</div>
                    <div class="stat-label">Completed</div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="glass-card">
                <div style="text-align: center; margin-bottom: 12px;">
                    <div style="font-size: 14px; font-weight: 600;">Level Progress</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">1,550 / 2,500 XP to Level 6</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 65%;"></div>
                </div>
            </div>

            <!-- Live Players -->
            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 6px; height: 6px; background: var(--success-green); border-radius: 50%;"></div>
                        <span style="font-size: 14px; font-weight: 600;">LIVE</span>
                        <span style="background: rgba(16, 185, 129, 0.2); color: var(--success-green); padding: 4px 8px; border-radius: 8px; font-size: 11px;">5 online</span>
                    </div>
                </div>
                <div style="display: flex; gap: 12px; overflow-x: auto;" id="livePlayersContainer">
                    <!-- Live players will be populated here -->
                </div>
            </div>

            <!-- Challenges Section -->
            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 style="font-size: 18px; font-weight: 600;">🎯 Choose Your Challenge</h3>
                    <button onclick="refreshChallenges()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-primary); padding: 8px; border-radius: 8px; cursor: pointer;">✨</button>
                </div>
                
                <div id="challengeSelection" class="challenge-grid">
                    <!-- Challenges will be populated here -->
                </div>
            </div>

            <!-- Action Button -->
            <div class="glass-card text-center">
                <div style="margin-bottom: 16px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Ready to become a champion?</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">Complete challenges, upload proof, earn titles!</div>
                </div>
                <button class="btn btn-primary" onclick="startRandomChallenge()">
                    🎯 START CHALLENGE
                </button>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('home')" data-tab="home">
                <div class="nav-icon">🎯</div>
                <div class="nav-label">Home</div>
            </div>
            <div class="nav-item" onclick="switchTab('challenges')" data-tab="challenges">
                <div class="nav-icon">🏆</div>
                <div class="nav-label">Champions</div>
                <div class="badge">3</div>
            </div>
            <div class="nav-item" onclick="switchTab('chat')" data-tab="chat">
                <div class="nav-icon">💬</div>
                <div class="nav-label">Chat</div>
            </div>
            <div class="nav-item" onclick="switchTab('social')" data-tab="social">
                <div class="nav-icon">👥</div>
                <div class="nav-label">Social</div>
                <div class="badge">5</div>
            </div>
            <div class="nav-item" onclick="switchTab('profile')" data-tab="profile">
                <div class="nav-icon">👤</div>
                <div class="nav-label">Profile</div>
            </div>
        </div>
    </div>

    <script>
        // ===== STABLE APPLICATION STATE =====
        
        class StableAppState {
            constructor() {
                this.user = {
                    name: 'Demo User',
                    level: 5,
                    tokens: 2450,
                    completedChallenges: 12
                };
                
                this.currentTab = 'home';
                this.isInitialized = false;
                
                this.init();
            }

            init() {
                try {
                    this.initializeData();
                    this.isInitialized = true;
                    console.log('✅ App initialized successfully');
                } catch (error) {
                    console.error('❌ Initialization failed:', error);
                    this.showToast('Something went wrong. Please refresh.', 'error');
                }
            }

            initializeData() {
                this.updateUserDisplay();
                this.generateChallenges();
                this.updateLivePlayersDisplay();
            }

            updateUserDisplay() {
                try {
                    const elements = {
                        'userDisplayName': this.user.name,
                        'userLevelDisplay': this.user.level,
                        'userTokensDisplay': this.user.tokens.toLocaleString(),
                        'userChallengesDisplay': this.user.completedChallenges,
                        'userStatus': `Level ${this.user.level}`
                    };

                    Object.entries(elements).forEach(([id, value]) => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.textContent = value;
                        }
                    });
                } catch (error) {
                    console.error('Display update failed:', error);
                }
            }

            generateChallenges() {
                try {
                    const challenges = [
                        {
                            id: 1,
                            title: 'Coffee Shop Poetry Challenge',
                            description: 'Visit a local coffee shop and ask them to write a poem on your cup',
                            difficulty: 'Easy',
                            tokens: 500,
                            icon: '☕'
                        },
                        {
                            id: 2,
                            title: 'Street Art Photography',
                            description: 'Find and photograph 5 different pieces of street art',
                            difficulty: 'Medium',
                            tokens: 650,
                            icon: '🎨'
                        },
                        {
                            id: 3,
                            title: 'Random Acts of Kindness',
                            description: 'Perform 3 random acts of kindness for strangers',
                            difficulty: 'Easy',
                            tokens: 750,
                            icon: '💝'
                        },
                        {
                            id: 4,
                            title: 'Morning Workout',
                            description: 'Complete a 30-minute workout before 9 AM',
                            difficulty: 'Medium',
                            tokens: 600,
                            icon: '💪'
                        }
                    ];
                    
                    const container = document.getElementById('challengeSelection');
                    if (!container) return;
                    
                    container.innerHTML = challenges.map(challenge => `
                        <div class="challenge-card" onclick="selectChallenge(${challenge.id})">
                            <div class="challenge-icon">${challenge.icon}</div>
                            <div class="challenge-title">${challenge.title}</div>
                            <div class="challenge-description">${challenge.description}</div>
                            <div class="challenge-meta">
                                <div class="challenge-difficulty">${challenge.difficulty}</div>
                                <div class="challenge-tokens">${challenge.tokens} tokens</div>
                            </div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Challenge generation failed:', error);
                }
            }

            updateLivePlayersDisplay() {
                try {
                    const players = [
                        { name: 'Alex', avatar: '😎', level: 5 },
                        { name: 'Maya', avatar: '🌟', level: 3 },
                        { name: 'Jordan', avatar: '🚀', level: 7 },
                        { name: 'Sam', avatar: '🎨', level: 4 }
                    ];
                    
                    const container = document.getElementById('livePlayersContainer');
                    if (!container) return;
                    
                    container.innerHTML = players.map(player => `
                        <div style="position: relative; flex-shrink: 0; cursor: pointer;" onclick="showToast('${player.name} - Level ${player.level}', 'info')">
                            <div style="width: 44px; height: 44px; border-radius: 22px; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); display: flex; align-items: center; justify-content: center; font-size: 18px;">
                                ${player.avatar}
                            </div>
                            <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); background: var(--secondary-color); color: white; font-size: 9px; padding: 2px 6px; border-radius: 6px;">L${player.level}</div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Live players update failed:', error);
                }
            }

            switchTab(tabName) {
                try {
                    this.currentTab = tabName;
                    
                    // Update nav active state
                    document.querySelectorAll('.nav-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
                    if (activeTab) {
                        activeTab.classList.add('active');
                    }
                    
                    this.showToast(`Switched to ${tabName}`, 'info');
                } catch (error) {
                    console.error('Tab switching failed:', error);
                }
            }

            showToast(message, type = 'info', duration = 3000) {
                try {
                    // Remove existing toasts
                    const existingToasts = document.querySelectorAll('.toast');
                    existingToasts.forEach(toast => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    });
                    
                    const toast = document.createElement('div');
                    toast.className = `toast ${type}`;
                    toast.textContent = message;
                    
                    document.body.appendChild(toast);
                    
                    requestAnimationFrame(() => {
                        toast.classList.add('show');
                    });
                    
                    setTimeout(() => {
                        toast.classList.remove('show');
                        setTimeout(() => {
                            if (toast.parentNode) {
                                toast.parentNode.removeChild(toast);
                            }
                        }, 300);
                    }, duration);
                } catch (error) {
                    console.error('Toast creation failed:', error);
                }
            }
        }

        // Global app state
        let appState;

        // ===== AUTHENTICATION FUNCTIONS =====

        function signInWithGoogle() {
            setLoadingState(true);
            showToast('🔍 Connecting to Google...', 'info');
            
            setTimeout(() => {
                completeAuthentication({ name: 'Google User', avatar: '🔍' });
                setLoadingState(false);
            }, 1500);
        }

        function signInWithFacebook() {
            setLoadingState(true);
            showToast('📘 Connecting to Facebook...', 'info');
            
            setTimeout(() => {
                completeAuthentication({ name: 'Facebook User', avatar: '📘' });
                setLoadingState(false);
            }, 1500);
        }

        function showPhoneForm() {
            document.getElementById('mainAuth').classList.add('hidden');
            document.getElementById('phoneForm').classList.remove('hidden');
        }

        function showMainAuth() {
            document.getElementById('phoneForm').classList.add('hidden');
            document.getElementById('mainAuth').classList.remove('hidden');
        }

        function signInWithPhone() {
            const phoneInput = document.getElementById('phoneInput');
            const phone = phoneInput.value.trim();
            
            if (!phone || phone.length < 10) {
                showError('Please enter a valid phone number');
                return;
            }
            
            setLoadingState(true);
            showToast('📱 Sending verification code...', 'info');
            
            setTimeout(() => {
                document.getElementById('otpInput').classList.remove('hidden');
                document.getElementById('phoneSubmitBtn').textContent = 'Verify Code';
                document.getElementById('phoneSubmitBtn').onclick = verifyOTP;
                showToast('📨 Code sent!', 'success');
                setLoadingState(false);
            }, 1500);
        }

        function verifyOTP() {
            const otpInput = document.getElementById('otpInput');
            const otp = otpInput.value.trim();
            
            if (!otp || otp.length < 4) {
                showError('Please enter the verification code');
                return;
            }
            
            setLoadingState(true);
            showToast('✅ Verifying...', 'info');
            
            setTimeout(() => {
                completeAuthentication({ name: 'Phone User', avatar: '📱' });
                setLoadingState(false);
            }, 1000);
        }

        function signInAnonymously() {
            setLoadingState(true);
            showToast('🧪 Entering test mode...', 'info');
            
            setTimeout(() => {
                completeAuthentication({ name: 'Demo Challenger', avatar: '🧪' });
                setLoadingState(false);
            }, 1000);
        }

        function completeAuthentication(user) {
            try {
                appState.user.name = user.name;
                appState.user.avatar = user.avatar;
                
                showToast(`🎉 Welcome ${user.name}!`, 'success');
                
                setTimeout(() => {
                    document.getElementById('authScreen').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    
                    appState.updateUserDisplay();
                }, 1000);
            } catch (error) {
                console.error('Authentication failed:', error);
                showToast('Authentication failed. Please try again.', 'error');
            }
        }

        function setLoadingState(loading) {
            const buttons = document.querySelectorAll('.auth-btn, .btn');
            buttons.forEach(button => {
                if (loading) {
                    button.classList.add('loading');
                    button.disabled = true;
                } else {
                    button.classList.remove('loading');
                    button.disabled = false;
                }
            });
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.remove('hidden');
                setTimeout(() => {
                    errorElement.classList.add('hidden');
                }, 5000);
            }
            showToast(message, 'error');
        }

        // ===== MAIN APP FUNCTIONS =====

        function selectChallenge(challengeId) {
            showToast(`🎯 Challenge ${challengeId} selected!`, 'success');
        }

        function startRandomChallenge() {
            const randomId = Math.floor(Math.random() * 4) + 1;
            selectChallenge(randomId);
        }

        function refreshChallenges() {
            showToast('✨ Generating new challenges...', 'info');
            
            setTimeout(() => {
                if (appState) {
                    appState.generateChallenges();
                }
                showToast('🎯 New challenges available!', 'success');
            }, 1000);
        }

        function switchTab(tabName) {
            if (appState) {
                appState.switchTab(tabName);
            }
        }

        function showToast(message, type = 'info', duration = 3000) {
            if (appState) {
                appState.showToast(message, type, duration);
            } else {
                console.log(`Toast: ${message}`);
            }
        }

        // ===== INITIALIZATION =====

        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('🚀 JomBro Stable Platform Loading...');
                
                // Initialize app state
                appState = new StableAppState();
                
                // Start with auth screen
                document.getElementById('authScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
                
                console.log('✅ JomBro Platform Ready!');
                
            } catch (error) {
                console.error('❌ Platform initialization failed:', error);
                
                // Fallback
                document.body.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #0a0a0a; color: white; text-align: center; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                        <div>
                            <div style="font-size: 48px; margin-bottom: 20px;">🚨</div>
                            <div style="font-size: 20px; font-weight: 600; margin-bottom: 10px;">Something went wrong</div>
                            <div style="font-size: 14px; color: #999; margin-bottom: 20px;">Please refresh to try again</div>
                            <button onclick="location.reload()" style="background: #ff6b9d; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 16px; cursor: pointer;">🔄 Refresh</button>
                        </div>
                    </div>
                `;
            }
        });

        // Simple error handling
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            if (appState) {
                appState.showToast('Something went wrong', 'error');
            }
        });

        // Clean up on page unload
        window.addEventListener('beforeunload', function() {
            console.log('👋 App closing...');
        });
        
    </script>
</body>
</html>
